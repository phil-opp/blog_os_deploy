<!doctype html><html lang=en><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code." name=description><meta content="Philipp Oppermann" name=author><link href=/css/edition-1/poole.css rel=stylesheet><link href=/css/edition-1/main.css rel=stylesheet><link href=/css/edition-1/isso.css rel=stylesheet><script async src=/js/edition-1/main.js></script><title>Double Faults | Writing an OS in Rust (First Edition)</title><body><div class="container content"><header class=masthead><h2 class=masthead-title><a href=/edition-1 title=Home>Writing an OS in Rust (First Edition)</a></h2><p><small>Philipp¬†Oppermann's¬†blog</small></header><main><h1>Double Faults</h1><time class=post-date datetime=2017-01-02> Jan 02, 2017 </time><aside id=toc-aside><h2>Table of Contents</h2><ol><li><a href=#what-is-a-double-fault>What is a Double Fault?</a> <ol><li><a href=#triggering-a-double-fault>Triggering a Double Fault</a><li><a href=#a-double-fault-handler>A Double Fault Handler</a></ol><li><a href=#causes-of-double-faults>Causes of Double Faults</a> <ol><li><a href=#kernel-stack-overflow>Kernel Stack Overflow</a></ol><li><a href=#switching-stacks>Switching Stacks</a> <ol><li><a href=#allocating-a-new-stack>Allocating a new Stack</a><li><a href=#the-ist-and-tss>The IST and TSS</a><li><a href=#the-global-descriptor-table-again>The Global Descriptor Table (again)</a><li><a href=#putting-it-together>Putting it together</a></ol><li><a href=#what-s-next>What‚Äôs next?</a></ol></aside><div class=warning><b>No longer updated!</b> You are viewing the a post of the first edition of ‚ÄúWriting an OS in Rust‚Äù, which is no longer updated. You can find the second edition <a href=https://os.phil-opp.com/edition-2/>here</a>.</div><p>In this post we explore double faults in detail. We also set up an <em>Interrupt Stack Table</em> to catch double faults on a separate kernel stack. This way, we can completely prevent triple faults, even on kernel stack overflow.</p><span id=continue-reading></span><p>As always, the complete source code is available on <a href=https://github.com/phil-opp/blog_os/tree/first_edition_post_10>GitHub</a>. Please file <a href=https://github.com/phil-opp/blog_os/issues>issues</a> for any problems, questions, or improvement suggestions. There is also a <a href=https://gitter.im/phil-opp/blog_os>gitter chat</a> and a comment section at the end of this page.<h2 id=what-is-a-double-fault><a aria-label="Anchor link for: what-is-a-double-fault" class=zola-anchor href=#what-is-a-double-fault>üîó</a>What is a Double Fault?</h2><p>In simplified terms, a double fault is a special exception that occurs when the CPU fails to invoke an exception handler. For example, it occurs when a page fault is triggered but there is no page fault handler registered in the <a href=https://os.phil-opp.com/handling-exceptions/#the-interrupt-descriptor-table>Interrupt Descriptor Table</a> (IDT). So it‚Äôs kind of similar to catch-all blocks in programming languages with exceptions, e.g. <code>catch(...)</code> in C++ or <code>catch(Exception e)</code> in Java or C#.<p>A double fault behaves like a normal exception. It has the vector number <code>8</code> and we can define a normal handler function for it in the IDT. It is really important to provide a double fault handler, because if a double fault is unhandled a fatal <em>triple fault</em> occurs. Triple faults can‚Äôt be caught and most hardware reacts with a system reset.<h3 id=triggering-a-double-fault><a aria-label="Anchor link for: triggering-a-double-fault" class=zola-anchor href=#triggering-a-double-fault>üîó</a>Triggering a Double Fault</h3><p>Let‚Äôs provoke a double fault by triggering an exception for that we didn‚Äôt define a handler function:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/lib.rs
</span><span>
</span><span>#[no_mangle]
</span><span style=color:#569cd6;>pub extern </span><span style=color:#d69d85;>"C" </span><span style=color:#569cd6;>fn </span><span>rust_main(multiboot_information_address: </span><span style=color:#569cd6;>usize</span><span>) {
</span><span>    </span><span style=color:#569cd6;>...
</span><span>    </span><span style=color:#608b4e;>// initialize our IDT
</span><span>    interrupts::init();
</span><span>
</span><span>    </span><span style=color:#608b4e;>// trigger a page fault
</span><span>    </span><span style=color:#569cd6;>unsafe </span><span>{
</span><span>        *(</span><span style=color:#b5cea8;>0xdeadbeaf </span><span style=color:#569cd6;>as *mut u64</span><span>) = </span><span style=color:#b5cea8;>42</span><span>;
</span><span>    };
</span><span>
</span><span>    println!(</span><span style=color:#d69d85;>"It did not crash!"</span><span>);
</span><span>    </span><span style=color:#569cd6;>loop </span><span>{}
</span><span>}
</span></code></pre><p>We try to write to address <code>0xdeadbeaf</code>, but the corresponding page is not present in the page tables. Thus, a page fault occurs. We haven‚Äôt registered a page fault handler in our <a href=https://os.phil-opp.com/handling-exceptions/#the-interrupt-descriptor-table>IDT</a>, so a double fault occurs.<p>When we start our kernel now, we see that it enters an endless boot loop:<p><img alt="boot loop" src=boot-loop.gif><p>The reason for the boot loop is the following:<ol><li>The CPU tries to write to <code>0xdeadbeaf</code>, which causes a page fault.<li>The CPU looks at the corresponding entry in the IDT and sees that the present bit isn‚Äôt set. Thus, it can‚Äôt call the page fault handler and a double fault occurs.<li>The CPU looks at the IDT entry of the double fault handler, but this entry is also non-present. Thus, a <em>triple</em> fault occurs.<li>A triple fault is fatal. QEMU reacts to it like most real hardware and issues a system reset.</ol><p>So in order to prevent this triple fault, we need to either provide a handler function for page faults or a double fault handler. Let‚Äôs start with the latter, since we want to avoid triple faults in all cases.<h3 id=a-double-fault-handler><a aria-label="Anchor link for: a-double-fault-handler" class=zola-anchor href=#a-double-fault-handler>üîó</a>A Double Fault Handler</h3><p>A double fault is a normal exception with an error code, so we can use our <code>handler_with_error_code</code> macro to create a wrapper function:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts.rs
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style=color:#569cd6;>static ref </span><span style=color:#b4cea8;>IDT</span><span>: idt::Idt = {
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> idt = idt::Idt::new();
</span><span>
</span><span>        idt.breakpoint.set_handler_fn(breakpoint_handler);
</span><span>        idt.double_fault.set_handler_fn(double_fault_handler);
</span><span>
</span><span>        idt
</span><span>    };
</span><span>}
</span><span>
</span><span style=color:#608b4e;>// our new double fault handler
</span><span style=color:#569cd6;>extern </span><span style=color:#d69d85;>"x86-interrupt" </span><span style=color:#569cd6;>fn </span><span>double_fault_handler(
</span><span>    stack_frame: </span><span style=color:#569cd6;>&mut</span><span> ExceptionStackFrame, _error_code: </span><span style=color:#569cd6;>u64</span><span>)
</span><span>{
</span><span>    println!(</span><span style=color:#d69d85;>"</span><span style=color:#e3bbab;>\n</span><span style=color:#d69d85;>EXCEPTION: DOUBLE FAULT</span><span style=color:#e3bbab;>\n</span><span style=color:#b4cea8;>{:#?}</span><span style=color:#d69d85;>"</span><span>, stack_frame);
</span><span>    </span><span style=color:#569cd6;>loop </span><span>{}
</span><span>}
</span></code></pre><p>Our handler prints a short error message and dumps the exception stack frame. The error code of the double fault handler is always zero, so there‚Äôs no reason to print it.<p>When we start our kernel now, we should see that the double fault handler is invoked:<p><img alt="QEMU printing EXCEPTION: DOUBLE FAULT and the exception stack frame" src=qemu-catch-double-fault.png><p>It worked! Here is what happens this time:<ol><li>The CPU executes tries to write to <code>0xdeadbeaf</code>, which causes a page fault.<li>Like before, the CPU looks at the corresponding entry in the IDT and sees that the present bit isn‚Äôt set. Thus, a double fault occurs.<li>The CPU jumps to the ‚Äì now present ‚Äì double fault handler.</ol><p>The triple fault (and the boot-loop) no longer occurs, since the CPU can now call the double fault handler.<p>That was quite straightforward! So why do we need a whole post for this topic? Well, we‚Äôre now able to catch <em>most</em> double faults, but there are some cases where our current approach doesn‚Äôt suffice.<h2 id=causes-of-double-faults><a aria-label="Anchor link for: causes-of-double-faults" class=zola-anchor href=#causes-of-double-faults>üîó</a>Causes of Double Faults</h2><p>Before we look at the special cases, we need to know the exact causes of double faults. Above, we used a pretty vague definition:<blockquote><p>A double fault is a special exception that occurs when the CPU fails to invoke an exception handler.</blockquote><p>What does <em>‚Äúfails to invoke‚Äù</em> mean exactly? The handler is not present? The handler is <a href=http://pages.cs.wisc.edu/%7Eremzi/OSTEP/vm-beyondphys.pdf>swapped out</a>? And what happens if a handler causes exceptions itself?<p>For example, what happens if‚Ä¶ :<ol><li>a divide-by-zero exception occurs, but the corresponding handler function is swapped out?<li>a page fault occurs, but the page fault handler is swapped out?<li>a divide-by-zero handler causes a breakpoint exception, but the breakpoint handler is swapped out?<li>our kernel overflows its stack and the <a href=https://os.phil-opp.com/remap-the-kernel/#creating-a-guard-page>guard page</a> is hit?</ol><p>Fortunately, the AMD64 manual (<a href=https://www.amd.com/system/files/TechDocs/24593.pdf>PDF</a>) has an exact definition (in Section 8.2.9). According to it, a ‚Äúdouble fault exception <em>can</em> occur when a second exception occurs during the handling of a prior (first) exception handler‚Äù. The <em>‚Äúcan‚Äù</em> is important: Only very specific combinations of exceptions lead to a double fault. These combinations are:<table><thead><tr><th>First Exception<th>Second Exception<tbody><tr><td><a href=https://wiki.osdev.org/Exceptions#Divide-by-zero_Error>Divide-by-zero</a>,<br><a href=https://wiki.osdev.org/Exceptions#Invalid_TSS>Invalid TSS</a>,<br><a href=https://wiki.osdev.org/Exceptions#Segment_Not_Present>Segment Not Present</a>,<br><a href=https://wiki.osdev.org/Exceptions#Stack-Segment_Fault>Stack-Segment Fault</a>,<br><a href=https://wiki.osdev.org/Exceptions#General_Protection_Fault>General Protection Fault</a><td><a href=https://wiki.osdev.org/Exceptions#Invalid_TSS>Invalid TSS</a>,<br><a href=https://wiki.osdev.org/Exceptions#Segment_Not_Present>Segment Not Present</a>,<br><a href=https://wiki.osdev.org/Exceptions#Stack-Segment_Fault>Stack-Segment Fault</a>,<br><a href=https://wiki.osdev.org/Exceptions#General_Protection_Fault>General Protection Fault</a><tr><td><a href=https://wiki.osdev.org/Exceptions#Page_Fault>Page Fault</a><td><a href=https://wiki.osdev.org/Exceptions#Page_Fault>Page Fault</a>,<br><a href=https://wiki.osdev.org/Exceptions#Invalid_TSS>Invalid TSS</a>,<br><a href=https://wiki.osdev.org/Exceptions#Segment_Not_Present>Segment Not Present</a>,<br><a href=https://wiki.osdev.org/Exceptions#Stack-Segment_Fault>Stack-Segment Fault</a>,<br><a href=https://wiki.osdev.org/Exceptions#General_Protection_Fault>General Protection Fault</a></table><p>So for example a divide-by-zero fault followed by a page fault is fine (the page fault handler is invoked), but a divide-by-zero fault followed by a general-protection fault leads to a double fault.<p>With the help of this table, we can answer the first three of the above questions:<ol><li>If a divide-by-zero exception occurs and the corresponding handler function is swapped out, a <em>page fault</em> occurs and the <em>page fault handler</em> is invoked.<li>If a page fault occurs and the page fault handler is swapped out, a <em>double fault</em> occurs and the <em>double fault handler</em> is invoked.<li>If a divide-by-zero handler causes a breakpoint exception, the CPU tries to invoke the breakpoint handler. If the breakpoint handler is swapped out, a <em>page fault</em> occurs and the <em>page fault handler</em> is invoked.</ol><p>In fact, even the case of a non-present handler follows this scheme: A non-present handler causes a <em>segment-not-present</em> exception. We didn‚Äôt define a segment-not-present handler, so another segment-not-present exception occurs. According to the table, this leads to a double fault.<h3 id=kernel-stack-overflow><a aria-label="Anchor link for: kernel-stack-overflow" class=zola-anchor href=#kernel-stack-overflow>üîó</a>Kernel Stack Overflow</h3><p>Let‚Äôs look at the fourth question:<blockquote><p>What happens if our kernel overflows its stack and the <a href=https://os.phil-opp.com/remap-the-kernel/#creating-a-guard-page>guard page</a> is hit?</blockquote><p>When our kernel overflows its stack and hits the guard page, a <em>page fault</em> occurs. The CPU looks up the page fault handler in the IDT and tries to push the <a href=https://os.phil-opp.com/handling-exceptions/#the-exception-stack-frame>exception stack frame</a> onto the stack. However, our current stack pointer still points to the non-present guard page. Thus, a second page fault occurs, which causes a double fault (according to the above table).<p>So the CPU tries to call our <em>double fault handler</em> now. However, on a double fault the CPU tries to push the exception stack frame, too. Our stack pointer still points to the guard page, so a <em>third</em> page fault occurs, which causes a <em>triple fault</em> and a system reboot. So our current double fault handler can‚Äôt avoid a triple fault in this case.<p>Let‚Äôs try it ourselves! We can easily provoke a kernel stack overflow by calling a function that recurses endlessly:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/lib.rs
</span><span>
</span><span>#[no_mangle]
</span><span style=color:#569cd6;>pub extern </span><span style=color:#d69d85;>"C" </span><span style=color:#569cd6;>fn </span><span>rust_main(multiboot_information_address: </span><span style=color:#569cd6;>usize</span><span>) {
</span><span>    </span><span style=color:#569cd6;>...
</span><span>    </span><span style=color:#608b4e;>// initialize our IDT
</span><span>    interrupts::init();
</span><span>
</span><span>    </span><span style=color:#569cd6;>fn </span><span>stack_overflow() {
</span><span>        stack_overflow(); </span><span style=color:#608b4e;>// for each recursion, the return address is pushed
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#608b4e;>// trigger a stack overflow
</span><span>    stack_overflow();
</span><span>
</span><span>    println!(</span><span style=color:#d69d85;>"It did not crash!"</span><span>);
</span><span>    </span><span style=color:#569cd6;>loop </span><span>{}
</span><span>}
</span></code></pre><p>When we try this code in QEMU, we see that the system enters a boot-loop again.<p>So how can we avoid this problem? We can‚Äôt omit the pushing of the exception stack frame, since the CPU itself does it. So we need to ensure somehow that the stack is always valid when a double fault exception occurs. Fortunately, the x86_64 architecture has a solution to this problem.<h2 id=switching-stacks><a aria-label="Anchor link for: switching-stacks" class=zola-anchor href=#switching-stacks>üîó</a>Switching Stacks</h2><p>The x86_64 architecture is able to switch to a predefined, known-good stack when an exception occurs. This switch happens at hardware level, so it can be performed before the CPU pushes the exception stack frame.<p>This switching mechanism is implemented as an <em>Interrupt Stack Table</em> (IST). The IST is a table of 7 pointers to known-good stacks. In Rust-like pseudo code:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>struct </span><span>InterruptStackTable {
</span><span>    stack_pointers: [Option&LTStackPointer>; 7],
</span><span>}
</span></code></pre><p>For each exception handler, we can choose a stack from the IST through the <code>options</code> field in the corresponding <a href=https://os.phil-opp.com/handling-exceptions/#the-interrupt-descriptor-table>IDT entry</a>. For example, we could use the first stack in the IST for our double fault handler. Then the CPU would automatically switch to this stack whenever a double fault occurs. This switch would happen before anything is pushed, so it would prevent the triple fault.<h3 id=allocating-a-new-stack><a aria-label="Anchor link for: allocating-a-new-stack" class=zola-anchor href=#allocating-a-new-stack>üîó</a>Allocating a new Stack</h3><p>In order to fill an Interrupt Stack Table later, we need a way to allocate new stacks. Therefore we extend our <code>memory</code> module with a new <code>stack_allocator</code> submodule:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/mod.rs
</span><span>
</span><span style=color:#569cd6;>mod </span><span>stack_allocator;
</span><span>
</span></code></pre><p>First, we create a new <code>StackAllocator</code> struct and a constructor function:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/stack_allocator.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>memory::paging::PageIter;
</span><span>
</span><span style=color:#569cd6;>pub struct </span><span>StackAllocator {
</span><span>    range: PageIter,
</span><span>}
</span><span>
</span><span style=color:#569cd6;>impl </span><span>StackAllocator {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>new(page_range: PageIter) -> StackAllocator {
</span><span>        StackAllocator { range: page_range }
</span><span>    }
</span><span>}
</span></code></pre><p>We create a simple <code>StackAllocator</code> that allocates stacks from a given range of pages (<code>PageIter</code> is an Iterator over a range of pages; we introduced it <a href=https://os.phil-opp.com/kernel-heap/#mapping-the-heap>in the kernel heap post</a>.).<p>We add a <code>alloc_stack</code> method that allocates a new stack:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/stack_allocator.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>memory::paging::{self, Page, ActivePageTable};
</span><span style=color:#569cd6;>use </span><span>memory::{</span><span style=color:#b4cea8;>PAGE_SIZE</span><span>, FrameAllocator};
</span><span>
</span><span style=color:#569cd6;>impl </span><span>StackAllocator {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>alloc_stack&LTFA: FrameAllocator>(</span><span style=color:#569cd6;>&mut </span><span>self,
</span><span>                                           active_table: </span><span style=color:#569cd6;>&mut</span><span> ActivePageTable,
</span><span>                                           frame_allocator: </span><span style=color:#569cd6;>&mut</span><span> FA,
</span><span>                                           size_in_pages: </span><span style=color:#569cd6;>usize</span><span>)
</span><span>                                           -> Option&LTStack> {
</span><span>        </span><span style=color:#569cd6;>if</span><span> size_in_pages == </span><span style=color:#b5cea8;>0 </span><span>{
</span><span>            </span><span style=color:#569cd6;>return </span><span>None; </span><span style=color:#608b4e;>/* a zero sized stack makes no sense */
</span><span>        }
</span><span>
</span><span>        </span><span style=color:#608b4e;>// clone the range, since we only want to change it on success
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> range = self.range.clone();
</span><span>
</span><span>        </span><span style=color:#608b4e;>// try to allocate the stack pages and a guard page
</span><span>        </span><span style=color:#569cd6;>let</span><span> guard_page = range.next();
</span><span>        </span><span style=color:#569cd6;>let</span><span> stack_start = range.next();
</span><span>        </span><span style=color:#569cd6;>let</span><span> stack_end = </span><span style=color:#569cd6;>if</span><span> size_in_pages == </span><span style=color:#b5cea8;>1 </span><span>{
</span><span>            stack_start
</span><span>        } </span><span style=color:#569cd6;>else </span><span>{
</span><span>            </span><span style=color:#608b4e;>// choose the (size_in_pages-2)th element, since index
</span><span>            </span><span style=color:#608b4e;>// starts at 0 and we already allocated the start page
</span><span>            range.nth(size_in_pages - </span><span style=color:#b5cea8;>2</span><span>)
</span><span>        };
</span><span>
</span><span>        </span><span style=color:#569cd6;>match </span><span>(guard_page, stack_start, stack_end) {
</span><span>            (Some(</span><span style=color:#569cd6;>_</span><span>), Some(start), Some(end)) </span><span style=color:#569cd6;>=> </span><span>{
</span><span>                </span><span style=color:#608b4e;>// success! write back updated range
</span><span>                self.range = range;
</span><span>
</span><span>                </span><span style=color:#608b4e;>// map stack pages to physical frames
</span><span>                </span><span style=color:#569cd6;>for</span><span> page </span><span style=color:#569cd6;>in </span><span>Page::range_inclusive(start, end) {
</span><span>                    active_table.map(page, paging::</span><span style=color:#b4cea8;>WRITABLE</span><span>, frame_allocator);
</span><span>                }
</span><span>
</span><span>                </span><span style=color:#608b4e;>// create a new stack
</span><span>                </span><span style=color:#569cd6;>let</span><span> top_of_stack = end.start_address() + </span><span style=color:#b4cea8;>PAGE_SIZE</span><span>;
</span><span>                Some(Stack::new(top_of_stack, start.start_address()))
</span><span>            }
</span><span>            </span><span style=color:#569cd6;>_ => </span><span>None, </span><span style=color:#608b4e;>/* not enough pages */
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The method takes mutable references to the <a href=https://os.phil-opp.com/page-tables/#page-table-ownership>ActivePageTable</a> and a <a href=https://os.phil-opp.com/allocating-frames/#a-frame-allocator>FrameAllocator</a>, since it needs to map the new virtual stack pages to physical frames. We define that the stack size is a multiple of the page size.<p>Instead of operating directly on <code>self.range</code>, we <a href=https://doc.rust-lang.org/nightly/core/clone/trait.Clone.html#tymethod.clone>clone</a> it and only write it back on success. This way, subsequent stack allocations can still succeed if there are pages left (e.g., a call with <code>size_in_pages = 3</code> can still succeed after a failed call with <code>size_in_pages = 100</code>).<p>In order to be able to clone <code>PageIter</code>, we add a <code>#[derive(Clone)]</code> to its definition in <code>src/memory/paging/mod.rs</code>. We also need to make the <code>start_address</code> method of the <code>Page</code> type public (in the same file).<p>The actual allocation is straightforward: First, we choose the next page as <a href=https://os.phil-opp.com/remap-the-kernel/#creating-a-guard-page>guard page</a>. Then we choose the next <code>size_in_pages</code> pages as stack pages using <a href=https://doc.rust-lang.org/nightly/core/iter/trait.Iterator.html#method.nth>Iterator::nth</a>. If all three variables are <code>Some</code>, the allocation succeeded and we map the stack pages to physical frames using <a href=https://os.phil-opp.com/page-tables/#more-mapping-functions>ActivePageTable::map</a>. The guard page remains unmapped.<p>Finally, we create and return a new <code>Stack</code>, which we define as follows:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/stack_allocator.rs
</span><span>
</span><span>#[derive(Debug)]
</span><span style=color:#569cd6;>pub struct </span><span>Stack {
</span><span>    top: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>    bottom: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>}
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Stack {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>new(top: </span><span style=color:#569cd6;>usize</span><span>, bottom: </span><span style=color:#569cd6;>usize</span><span>) -> Stack {
</span><span>        assert!(top > bottom);
</span><span>        Stack {
</span><span>            top: top,
</span><span>            bottom: bottom,
</span><span>        }
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>top(</span><span style=color:#569cd6;>&</span><span>self) -> </span><span style=color:#569cd6;>usize </span><span>{
</span><span>        self.top
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>bottom(</span><span style=color:#569cd6;>&</span><span>self) -> </span><span style=color:#569cd6;>usize </span><span>{
</span><span>        self.bottom
</span><span>    }
</span><span>}
</span></code></pre><p>The <code>Stack</code> struct describes a stack though its top and bottom addresses.<h4 id=the-memory-controller><a aria-label="Anchor link for: the-memory-controller" class=zola-anchor href=#the-memory-controller>üîó</a>The Memory Controller</h4><p>Now we‚Äôre able to allocate a new double fault stack. However, we add one more level of abstraction to make things easier. For that we add a new <code>MemoryController</code> type to our <code>memory</code> module:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/mod.rs
</span><span>
</span><span style=color:#569cd6;>pub use </span><span>self::stack_allocator::Stack;
</span><span>
</span><span style=color:#569cd6;>pub struct </span><span>MemoryController {
</span><span>    active_table: paging::ActivePageTable,
</span><span>    frame_allocator: AreaFrameAllocator,
</span><span>    stack_allocator: stack_allocator::StackAllocator,
</span><span>}
</span><span>
</span><span style=color:#569cd6;>impl </span><span>MemoryController {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>alloc_stack(</span><span style=color:#569cd6;>&mut </span><span>self, size_in_pages: </span><span style=color:#569cd6;>usize</span><span>) -> Option&LTStack> {
</span><span>        </span><span style=color:#569cd6;>let &mut</span><span> MemoryController { </span><span style=color:#569cd6;>ref mut</span><span> active_table,
</span><span>                                    </span><span style=color:#569cd6;>ref mut</span><span> frame_allocator,
</span><span>                                    </span><span style=color:#569cd6;>ref mut</span><span> stack_allocator } = self;
</span><span>        stack_allocator.alloc_stack(active_table, frame_allocator,
</span><span>                                    size_in_pages)
</span><span>    }
</span><span>}
</span></code></pre><p>The <code>MemoryController</code> struct holds the three types that are required for <code>alloc_stack</code> and provides a simpler interface (only one argument). The <code>alloc_stack</code> wrapper just takes the tree types as <code>&mut</code> through <a href=https://doc.rust-lang.org/1.10.0/book/patterns.html#destructuring>destructuring</a> and forwards them to the <code>stack_allocator</code>. The <a href=https://doc.rust-lang.org/1.30.0/book/second-edition/ch18-03-pattern-syntax.html#creating-references-in-patterns-with-ref-and-ref-mut>ref mut</a>-s are needed to take the inner fields by mutable reference. Note that we‚Äôre re-exporting the <code>Stack</code> type since it is returned by <code>alloc_stack</code>.<p>The last step is to create a <code>StackAllocator</code> and return a <code>MemoryController</code> from <code>memory::init</code>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/mod.rs
</span><span>
</span><span style=color:#569cd6;>pub fn </span><span>init(boot_info: </span><span style=color:#569cd6;>&</span><span>BootInformation) -> MemoryController {
</span><span>    </span><span style=color:#569cd6;>...
</span><span>
</span><span>    </span><span style=color:#569cd6;>let</span><span> stack_allocator = {
</span><span>        </span><span style=color:#569cd6;>let</span><span> stack_alloc_start = heap_end_page + </span><span style=color:#b5cea8;>1</span><span>;
</span><span>        </span><span style=color:#569cd6;>let</span><span> stack_alloc_end = stack_alloc_start + </span><span style=color:#b5cea8;>100</span><span>;
</span><span>        </span><span style=color:#569cd6;>let</span><span> stack_alloc_range = Page::range_inclusive(stack_alloc_start,
</span><span>                                                      stack_alloc_end);
</span><span>        stack_allocator::StackAllocator::new(stack_alloc_range)
</span><span>    };
</span><span>
</span><span>    MemoryController {
</span><span>        active_table: active_table,
</span><span>        frame_allocator: frame_allocator,
</span><span>        stack_allocator: stack_allocator,
</span><span>    }
</span><span>}
</span></code></pre><p>We create a new <code>StackAllocator</code> with a range of 100 pages starting right after the last heap page.<p>In order to do arithmetic on pages (e.g. calculate the hundredth page after <code>stack_alloc_start</code>), we implement <code>Add&LTusize></code> for <code>Page</code>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/memory/paging/mod.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>core::ops::Add;
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Add<</span><span style=color:#569cd6;>usize</span><span>> </span><span style=color:#569cd6;>for </span><span>Page {
</span><span>    </span><span style=color:#569cd6;>type </span><span style=color:#4ec9b0;>Output </span><span>= Page;
</span><span>
</span><span>    </span><span style=color:#569cd6;>fn </span><span>add(self, rhs: </span><span style=color:#569cd6;>usize</span><span>) -> Page {
</span><span>        Page { number: self.number + rhs }
</span><span>    }
</span><span>}
</span></code></pre><h4 id=allocating-a-double-fault-stack><a aria-label="Anchor link for: allocating-a-double-fault-stack" class=zola-anchor href=#allocating-a-double-fault-stack>üîó</a>Allocating a Double Fault Stack</h4><p>Now we can allocate a new double fault stack by passing the memory controller to our <code>interrupts::init</code> function:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/lib.rs
</span><span>
</span><span>#[no_mangle]
</span><span style=color:#569cd6;>pub extern </span><span style=color:#d69d85;>"C" </span><span style=color:#569cd6;>fn </span><span>rust_main(multiboot_information_address: </span><span style=color:#569cd6;>usize</span><span>) {
</span><span>    </span><span style=color:#569cd6;>...
</span><span>
</span><span>    </span><span style=color:#608b4e;>// set up guard page and map the heap pages
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> memory_controller = memory::init(boot_info); </span><span style=color:#608b4e;>// new return type
</span><span>
</span><span>    </span><span style=color:#608b4e;>// initialize our IDT
</span><span>    interrupts::init(</span><span style=color:#569cd6;>&mut</span><span> memory_controller); </span><span style=color:#608b4e;>// new argument
</span><span>
</span><span>    </span><span style=color:#569cd6;>...
</span><span>}
</span><span>
</span><span>
</span><span style=color:#608b4e;>// in src/interrupts.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>memory::MemoryController;
</span><span>
</span><span style=color:#569cd6;>pub fn </span><span>init(memory_controller: </span><span style=color:#569cd6;>&mut</span><span> MemoryController) {
</span><span>    </span><span style=color:#569cd6;>let</span><span> double_fault_stack = memory_controller.alloc_stack(</span><span style=color:#b5cea8;>1</span><span>)
</span><span>        .expect(</span><span style=color:#d69d85;>"could not allocate double fault stack"</span><span>);
</span><span>
</span><span>    </span><span style=color:#b4cea8;>IDT</span><span>.load();
</span><span>}
</span></code></pre><p>We allocate a 4096 bytes stack (one page) for our double fault handler. Now we just need some way to tell the CPU that it should use this stack for handling double faults.<h3 id=the-ist-and-tss><a aria-label="Anchor link for: the-ist-and-tss" class=zola-anchor href=#the-ist-and-tss>üîó</a>The IST and TSS</h3><p>The Interrupt Stack Table (IST) is part of an old legacy structure called <em><a href=https://en.wikipedia.org/wiki/Task_state_segment>Task State Segment</a></em> (TSS). The TSS used to hold various information (e.g. processor register state) about a task in 32-bit mode and was for example used for <a href=https://wiki.osdev.org/Context_Switching#Hardware_Context_Switching>hardware context switching</a>. However, hardware context switching is no longer supported in 64-bit mode and the format of the TSS changed completely.<p>On x86_64, the TSS no longer holds any task specific information at all. Instead, it holds two stack tables (the IST is one of them). The only common field between the 32-bit and 64-bit TSS is the pointer to the <a href=https://en.wikipedia.org/wiki/Task_state_segment#I.2FO_port_permissions>I/O port permissions bitmap</a>.<p>The 64-bit TSS has the following format:<table><thead><tr><th>Field<th>Type<tbody><tr><td><span style="opacity: 0.5">(reserved)</span><td><code>u32</code><tr><td>Privilege Stack Table<td><code>[u64; 3]</code><tr><td><span style="opacity: 0.5">(reserved)</span><td><code>u64</code><tr><td>Interrupt Stack Table<td><code>[u64; 7]</code><tr><td><span style="opacity: 0.5">(reserved)</span><td><code>u64</code><tr><td><span style="opacity: 0.5">(reserved)</span><td><code>u16</code><tr><td>I/O Map Base Address<td><code>u16</code></table><p>The <em>Privilege Stack Table</em> is used by the CPU when the privilege level changes. For example, if an exception occurs while the CPU is in user mode (privilege level 3), the CPU normally switches to kernel mode (privilege level 0) before invoking the exception handler. In that case, the CPU would switch to the 0th stack in the Privilege Stack Table (since 0 is the target privilege level). We don‚Äôt have any user mode programs yet, so we ignore this table for now.<h4 id=creating-a-tss><a aria-label="Anchor link for: creating-a-tss" class=zola-anchor href=#creating-a-tss>üîó</a>Creating a TSS</h4><p>Let‚Äôs create a new TSS that contains our double fault stack in its interrupt stack table. For that we need a TSS struct. Fortunately, the <code>x86_64</code> crate already contains a <a href=https://docs.rs/x86_64/0.1.1/x86_64/structures/tss/struct.TaskStateSegment.html><code>TaskStateSegment</code> struct</a> that we can use:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>x86_64::structures::tss::TaskStateSegment;
</span></code></pre><p>Let‚Äôs create a new TSS in our <code>interrupts::init</code> function:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>x86_64::VirtualAddress;
</span><span>
</span><span style=color:#569cd6;>const </span><span style=color:#b4cea8;>DOUBLE_FAULT_IST_INDEX</span><span>: </span><span style=color:#569cd6;>usize </span><span>= </span><span style=color:#b5cea8;>0</span><span>;
</span><span>
</span><span style=color:#569cd6;>pub fn </span><span>init(memory_controller: </span><span style=color:#569cd6;>&mut</span><span> MemoryController) {
</span><span>    </span><span style=color:#569cd6;>let</span><span> double_fault_stack = memory_controller.alloc_stack(</span><span style=color:#b5cea8;>1</span><span>)
</span><span>        .expect(</span><span style=color:#d69d85;>"could not allocate double fault stack"</span><span>);
</span><span>
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> tss = TaskStateSegment::new();
</span><span>    tss.interrupt_stack_table[</span><span style=color:#b4cea8;>DOUBLE_FAULT_IST_INDEX</span><span>] = VirtualAddress(
</span><span>        double_fault_stack.top());
</span><span>
</span><span>    </span><span style=color:#b4cea8;>IDT</span><span>.load();
</span><span>}
</span></code></pre><p>We define that the 0th IST entry is the double fault stack (any other IST index would work too). We create a new TSS through the <code>TaskStateSegment::new</code> function and load the top address (stacks grow downwards) of the double fault stack into the 0th entry.<h4 id=loading-the-tss><a aria-label="Anchor link for: loading-the-tss" class=zola-anchor href=#loading-the-tss>üîó</a>Loading the TSS</h4><p>Now that we created a new TSS, we need a way to tell the CPU that it should use it. Unfortunately, this is a bit cumbersome, since the TSS is a Task State <em>Segment</em> (for historical reasons). So instead of loading the table directly, we need to add a new segment descriptor to the <a href=https://web.archive.org/web/20190217233448/https://www.flingos.co.uk/docs/reference/Global-Descriptor-Table/>Global Descriptor Table</a> (GDT). Then we can load our TSS invoking the <a href=https://www.felixcloutier.com/x86/ltr><code>ltr</code> instruction</a> with the respective GDT index.<h3 id=the-global-descriptor-table-again><a aria-label="Anchor link for: the-global-descriptor-table-again" class=zola-anchor href=#the-global-descriptor-table-again>üîó</a>The Global Descriptor Table (again)</h3><p>The Global Descriptor Table (GDT) is a relict that was used for <a href=https://en.wikipedia.org/wiki/X86_memory_segmentation>memory segmentation</a> before paging became the de facto standard. It is still needed in 64-bit mode for various things such as kernel/user mode configuration or TSS loading.<p>We already created a GDT <a href=https://os.phil-opp.com/entering-longmode/#the-global-descriptor-table>when switching to long mode</a>. Back then, we used assembly to create valid code and data segment descriptors, which were required to enter 64-bit mode. We could just edit that assembly file and add an additional TSS descriptor. However, we now have the expressiveness of Rust, so let‚Äôs do it in Rust instead.<p>We start by creating a new <code>interrupts::gdt</code> submodule. For that we need to rename the <code>src/interrupts.rs</code> file to <code>src/interrupts/mod.rs</code>. Then we can create a new submodule:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/mod.rs
</span><span>
</span><span style=color:#569cd6;>mod </span><span>gdt;
</span></code></pre><pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>pub struct </span><span>Gdt {
</span><span>    table: [</span><span style=color:#569cd6;>u64</span><span>; 8],
</span><span>    next_free: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>}
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Gdt {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>new() -> Gdt {
</span><span>        Gdt {
</span><span>            table: [</span><span style=color:#b5cea8;>0</span><span>; </span><span style=color:#b5cea8;>8</span><span>],
</span><span>            next_free: </span><span style=color:#b5cea8;>1</span><span>,
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>We create a simple <code>Gdt</code> struct with two fields. The <code>table</code> field contains the actual GDT modeled as a <code>[u64; 8]</code>. Theoretically, a GDT can have up to 8192 entries, but this doesn‚Äôt make much sense in 64-bit mode (since there is no real segmentation support). Eight entries should be more than enough for our system.<p>The <code>next_free</code> field stores the index of the next free entry. We initialize it with <code>1</code> since the 0th entry needs always needs to be 0 in a valid GDT.<h4 id=user-and-system-segments><a aria-label="Anchor link for: user-and-system-segments" class=zola-anchor href=#user-and-system-segments>üîó</a>User and System Segments</h4><p>There are two types of GDT entries in long mode: user and system segment descriptors. Descriptors for code and data segment segments are user segment descriptors. They contain no addresses since segments always span the complete address space on x86_64 (real segmentation is no longer supported). Thus, user segment descriptors only contain a few flags (e.g. present or user mode) and fit into a single <code>u64</code> entry.<p>System descriptors such as TSS descriptors are different. They often contain a base address and a limit (e.g. TSS start and length) and thus need more than 64 bits. Therefore, system segments are 128 bits. They are stored as two consecutive entries in the GDT.<p>Consequently, we model a <code>Descriptor</code> as an <code>enum</code>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>pub enum </span><span>Descriptor {
</span><span>    UserSegment(</span><span style=color:#569cd6;>u64</span><span>),
</span><span>    SystemSegment(</span><span style=color:#569cd6;>u64</span><span>, </span><span style=color:#569cd6;>u64</span><span>),
</span><span>}
</span></code></pre><p>The flag bits are common between all descriptor types, so we create a general <code>DescriptorFlags</code> type (using the <a href=https://docs.rs/bitflags/0.9.1/bitflags/macro.bitflags.html>bitflags</a> macro):<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span>bitflags! {
</span><span>    </span><span style=color:#569cd6;>struct </span><span>DescriptorFlags: u64 {
</span><span>        const CONFORMING        = 1 << 42;
</span><span>        const EXECUTABLE        = 1 << 43;
</span><span>        const USER_SEGMENT      = 1 << 44;
</span><span>        const PRESENT           = 1 << 47;
</span><span>        const LONG_MODE         = 1 << 53;
</span><span>    }
</span><span>}
</span></code></pre><p>We only add flags that are relevant in 64-bit mode. For example, we omit the read/write bit, since it is completely ignored by the CPU in 64-bit mode.<h4 id=code-segments><a aria-label="Anchor link for: code-segments" class=zola-anchor href=#code-segments>üîó</a>Code Segments</h4><p>We add a function to create kernel mode code segments:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Descriptor {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>kernel_code_segment() -> Descriptor {
</span><span>        </span><span style=color:#569cd6;>let</span><span> flags = </span><span style=color:#b4cea8;>USER_SEGMENT </span><span style=color:#569cd6;>| </span><span style=color:#b4cea8;>PRESENT </span><span style=color:#569cd6;>| </span><span style=color:#b4cea8;>EXECUTABLE </span><span style=color:#569cd6;>| </span><span style=color:#b4cea8;>LONG_MODE</span><span>;
</span><span>        Descriptor::UserSegment(flags.bits())
</span><span>    }
</span><span>}
</span></code></pre><p>We set the <code>USER_SEGMENT</code> bit to indicate a 64 bit user segment descriptor (otherwise the CPU expects a 128 bit system segment descriptor). The <code>PRESENT</code>, <code>EXECUTABLE</code>, and <code>LONG_MODE</code> bits are also needed for a 64-bit mode code segment.<p>The data segment registers <code>ds</code>, <code>ss</code>, and <code>es</code> are completely ignored in 64-bit mode, so we don‚Äôt need any data segment descriptors in our GDT.<h4 id=tss-segments><a aria-label="Anchor link for: tss-segments" class=zola-anchor href=#tss-segments>üîó</a>TSS Segments</h4><p>A TSS descriptor is a system segment descriptor with the following format:<table><thead><tr><th>Bit(s)<th>Name<th>Meaning<tbody><tr><td>0-15<td><strong>limit 0-15</strong><td>the first 2 byte of the TSS‚Äôs limit<tr><td>16-39<td><strong>base 0-23</strong><td>the first 3 byte of the TSS‚Äôs base address<tr><td>40-43<td><strong>type</strong><td>must be <code>0b1001</code> for an available 64-bit TSS<tr><td>44<td>zero<td>must be 0<tr><td>45-46<td>privilege<td>the <a href=https://wiki.osdev.org/Security#Rings>ring level</a>: 0 for kernel, 3 for user<tr><td>47<td><strong>present</strong><td>must be 1 for valid selectors<tr><td>48-51<td>limit 16-19<td>bits 16 to 19 of the segment‚Äôs limit<tr><td>52<td>available<td>freely available to the OS<tr><td>53-54<td>ignored<td><tr><td>55<td>granularity<td>if it‚Äôs set, the limit is the number of pages, else it‚Äôs a byte number<tr><td>56-63<td><strong>base 24-31</strong><td>the fourth byte of the base address<tr><td>64-95<td><strong>base 32-63</strong><td>the last four bytes of the base address<tr><td>96-127<td>ignored/must be zero<td>bits 104-108 must be zero, the rest is ignored</table><p>We only need the bold fields for our TSS descriptor. For example, we don‚Äôt need the <code>limit 16-19</code> field since a TSS has a fixed size that is smaller than <code>2^16</code>.<p>Let‚Äôs add a function to our descriptor that creates a TSS descriptor for a given TSS:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>x86_64::structures::tss::TaskStateSegment;
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Descriptor {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>tss_segment(tss: </span><span style=color:#569cd6;>&'static</span><span> TaskStateSegment) -> Descriptor {
</span><span>        </span><span style=color:#569cd6;>use </span><span>core::mem::size_of;
</span><span>        </span><span style=color:#569cd6;>use </span><span>bit_field::BitField;
</span><span>
</span><span>        </span><span style=color:#569cd6;>let</span><span> ptr = tss </span><span style=color:#569cd6;>as *const _ as u64</span><span>;
</span><span>
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> low = </span><span style=color:#b4cea8;>PRESENT</span><span>.bits();
</span><span>        </span><span style=color:#608b4e;>// base
</span><span>        low.set_bits(</span><span style=color:#b5cea8;>16</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>40</span><span>, ptr.get_bits(</span><span style=color:#b5cea8;>0</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>24</span><span>));
</span><span>        low.set_bits(</span><span style=color:#b5cea8;>56</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>64</span><span>, ptr.get_bits(</span><span style=color:#b5cea8;>24</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>32</span><span>));
</span><span>        </span><span style=color:#608b4e;>// limit (the `-1` in needed since the bound is inclusive)
</span><span>        low.set_bits(</span><span style=color:#b5cea8;>0</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>16</span><span>, (size_of::&LTTaskStateSegment>() - </span><span style=color:#b5cea8;>1</span><span>) </span><span style=color:#569cd6;>as u64</span><span>);
</span><span>        </span><span style=color:#608b4e;>// type (0b1001 = available 64-bit tss)
</span><span>        low.set_bits(</span><span style=color:#b5cea8;>40</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>44</span><span>, </span><span style=color:#b5cea8;>0b1001</span><span>);
</span><span>
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> high = </span><span style=color:#b5cea8;>0</span><span>;
</span><span>        high.set_bits(</span><span style=color:#b5cea8;>0</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>32</span><span>, ptr.get_bits(</span><span style=color:#b5cea8;>32</span><span style=color:#569cd6;>..</span><span style=color:#b5cea8;>64</span><span>));
</span><span>
</span><span>        Descriptor::SystemSegment(low, high)
</span><span>    }
</span><span>}
</span></code></pre><p>The <code>set_bits</code> and <code>get_bits</code> methods are provided by the <a href=https://docs.rs/bit_field/0.6.0/bit_field/trait.BitField.html#method.get_bit><code>BitField</code> trait</a> of the <code>bit_fields</code> crate. They allow us to easily get or set specific bits in an integer without using bit masks or shift operations. For example, we can do <code>x.set_bits(8..12, 42)</code> instead of <code>x = (x & 0xfffff0ff) | (42 << 8)</code>.<p>To link the <code>bit_fields</code> crate, we modify our <code>Cargo.toml</code> and our <code>src/lib.rs</code>:<pre class=language-toml data-lang=toml style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-toml data-lang=toml><span>[</span><span style=color:#808080;>dependencies</span><span>]
</span><span style=color:#569cd6;>bit_field </span><span>= </span><span style=color:#d69d85;>"0.7.0"
</span></code></pre><pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>extern crate</span><span> bit_field;
</span></code></pre><p>We require the <code>'static</code> lifetime for the <code>TaskStateSegment</code> reference, since the hardware might access it on every interrupt as long as the OS runs.<h4 id=adding-descriptors-to-the-gdt><a aria-label="Anchor link for: adding-descriptors-to-the-gdt" class=zola-anchor href=#adding-descriptors-to-the-gdt>üîó</a>Adding Descriptors to the GDT</h4><p>In order to add descriptors to the GDT, we add a <code>add_entry</code> method:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>x86_64::structures::gdt::SegmentSelector;
</span><span style=color:#569cd6;>use </span><span>x86_64::PrivilegeLevel;
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Gdt {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>add_entry(</span><span style=color:#569cd6;>&mut </span><span>self, entry: Descriptor) -> SegmentSelector {
</span><span>        </span><span style=color:#569cd6;>let</span><span> index = </span><span style=color:#569cd6;>match</span><span> entry {
</span><span>            Descriptor::UserSegment(value) </span><span style=color:#569cd6;>=> </span><span>self.push(value),
</span><span>            Descriptor::SystemSegment(value_low, value_high) </span><span style=color:#569cd6;>=> </span><span>{
</span><span>                </span><span style=color:#569cd6;>let</span><span> index = self.push(value_low);
</span><span>                self.push(value_high);
</span><span>                index
</span><span>            }
</span><span>        };
</span><span>        SegmentSelector::new(index </span><span style=color:#569cd6;>as u16</span><span>, PrivilegeLevel::Ring0)
</span><span>    }
</span><span>}
</span></code></pre><p>For an user segment we just push the <code>u64</code> and remember the index. For a system segment, we push the low and high <code>u64</code> and use the index of the low value. We then use this index to return a new <a href=https://docs.rs/x86/0.8.0/x86/shared/segmentation/struct.SegmentSelector.html#method.new>SegmentSelector</a>.<p>The <code>push</code> method looks like this:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Gdt {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>push(</span><span style=color:#569cd6;>&mut </span><span>self, value: </span><span style=color:#569cd6;>u64</span><span>) -> </span><span style=color:#569cd6;>usize </span><span>{
</span><span>        </span><span style=color:#569cd6;>if </span><span>self.next_free < self.table.len() {
</span><span>            </span><span style=color:#569cd6;>let</span><span> index = self.next_free;
</span><span>            self.table[index] = value;
</span><span>            self.next_free += </span><span style=color:#b5cea8;>1</span><span>;
</span><span>            index
</span><span>        } </span><span style=color:#569cd6;>else </span><span>{
</span><span>            panic!(</span><span style=color:#d69d85;>"GDT full"</span><span>);
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>The method just writes to the <code>next_free</code> entry and returns the corresponding index. If there is no free entry left, we panic since this likely indicates a programming error (we should never need to create more than two or three GDT entries for our kernel).<h4 id=loading-the-gdt><a aria-label="Anchor link for: loading-the-gdt" class=zola-anchor href=#loading-the-gdt>üîó</a>Loading the GDT</h4><p>To load the GDT, we add a new <code>load</code> method:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/gdt.rs
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Gdt {
</span><span>    </span><span style=color:#569cd6;>pub fn </span><span>load(</span><span style=color:#569cd6;>&'static </span><span>self) {
</span><span>        </span><span style=color:#569cd6;>use </span><span>x86_64::instructions::tables::{DescriptorTablePointer, lgdt};
</span><span>        </span><span style=color:#569cd6;>use </span><span>core::mem::size_of;
</span><span>
</span><span>        </span><span style=color:#569cd6;>let</span><span> ptr = DescriptorTablePointer {
</span><span>            base: self.table.as_ptr() </span><span style=color:#569cd6;>as u64</span><span>,
</span><span>            limit: (self.table.len() * size_of::<</span><span style=color:#569cd6;>u64</span><span>>() - </span><span style=color:#b5cea8;>1</span><span>) </span><span style=color:#569cd6;>as u16</span><span>,
</span><span>        };
</span><span>
</span><span>        </span><span style=color:#569cd6;>unsafe </span><span>{ lgdt(</span><span style=color:#569cd6;>&</span><span>ptr) };
</span><span>    }
</span><span>}
</span></code></pre><p>We use the <a href=https://docs.rs/x86_64/0.1.1/x86_64/instructions/tables/struct.DescriptorTablePointer.html><code>DescriptorTablePointer</code> struct</a> and the <a href=https://docs.rs/x86_64/0.1.1/x86_64/instructions/tables/fn.lgdt.html><code>lgdt</code> function</a> provided by the <code>x86_64</code> crate to load our GDT. Again, we require a <code>'static</code> reference since the GDT possibly needs to live for the rest of the run time.<h3 id=putting-it-together><a aria-label="Anchor link for: putting-it-together" class=zola-anchor href=#putting-it-together>üîó</a>Putting it together</h3><p>We now have a double fault stack and are able to create and load a TSS (which contains an IST). So let‚Äôs put everything together to catch kernel stack overflows.<p>We already created a new TSS in our <code>interrupts::init</code> function. Now we can load this TSS by creating a new GDT:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/mod.rs
</span><span>
</span><span style=color:#569cd6;>pub fn </span><span>init(memory_controller: </span><span style=color:#569cd6;>&mut</span><span> MemoryController) {
</span><span>    </span><span style=color:#569cd6;>let</span><span> double_fault_stack = memory_controller.alloc_stack(</span><span style=color:#b5cea8;>1</span><span>)
</span><span>        .expect(</span><span style=color:#d69d85;>"could not allocate double fault stack"</span><span>);
</span><span>
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> tss = TaskStateSegment::new();
</span><span>    tss.interrupt_stack_table[</span><span style=color:#b4cea8;>DOUBLE_FAULT_IST_INDEX</span><span>] = VirtualAddress(
</span><span>        double_fault_stack.top());
</span><span>
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> gdt = gdt::Gdt::new();
</span><span>    </span><span style=color:#569cd6;>let</span><span> code_selector = gdt.add_entry(gdt::Descriptor::kernel_code_segment());
</span><span>    </span><span style=color:#569cd6;>let</span><span> tss_selector = gdt.add_entry(gdt::Descriptor::tss_segment(</span><span style=color:#569cd6;>&</span><span>tss));
</span><span>    gdt.load();
</span><span>
</span><span>    </span><span style=color:#b4cea8;>IDT</span><span>.load();
</span><span>}
</span></code></pre><p>However, when we try to compile it, the following errors occur:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>error: `tss` does not live long enough
</span><span>   --> src/interrupts/mod.rs:118:68
</span><span>    |
</span><span>118 |    let tss_selector = gdt.add_entry(gdt::Descriptor::tss_segment(&tss));
</span><span>    |                                         does not live long enough ^^^
</span><span>...
</span><span>122 | }
</span><span>    | - borrowed value only lives until here
</span><span>    |
</span><span>    = note: borrowed value must be valid for the static lifetime...
</span><span>
</span><span>error: `gdt` does not live long enough
</span><span>   --> src/interrupts/mod.rs:119:5
</span><span>    |
</span><span>119 |    gdt.load();
</span><span>    |    ^^^ does not live long enough
</span><span>...
</span><span>122 | }
</span><span>    | - borrowed value only lives until here
</span><span>    |
</span><span>    = note: borrowed value must be valid for the static lifetime...
</span></code></pre><p>The problem is that we require that the TSS and GDT are valid for the rest of the run time (i.e. for the <code>'static</code> lifetime). But our created <code>tss</code> and <code>gdt</code> live on the stack and are thus destroyed at the end of the <code>init</code> function. So how do we fix this problem?<p>We could allocate our TSS and GDT on the heap using <code>Box</code> and use <a href=https://doc.rust-lang.org/std/boxed/struct.Box.html#method.into_raw>into_raw</a> and a bit of <code>unsafe</code> to convert it to <code>&'static</code> references (<a href=https://github.com/rust-lang/rfcs/pull/1233>RFC 1233</a> was closed unfortunately).<p>Alternatively, we could store them in a <code>static</code> somehow. The <a href=https://docs.rs/lazy_static/0.2.2/lazy_static/><code>lazy_static</code> macro</a> doesn‚Äôt work here, since we need access to the <code>MemoryController</code> for initialization. However, we can use its fundamental building block, the <a href=https://docs.rs/spin/0.4.5/spin/struct.Once.html><code>spin::Once</code> type</a>.<h4 id=spin-once><a aria-label="Anchor link for: spin-once" class=zola-anchor href=#spin-once>üîó</a>spin::Once</h4><p>Let‚Äôs try to solve our problem using <a href=https://docs.rs/spin/0.4.5/spin/struct.Once.html><code>spin::Once</code></a>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/mod.rs
</span><span>
</span><span style=color:#569cd6;>use </span><span>spin::Once;
</span><span>
</span><span style=color:#569cd6;>static </span><span style=color:#b4cea8;>TSS</span><span>: Once&LTTaskStateSegment> = Once::new();
</span><span style=color:#569cd6;>static </span><span style=color:#b4cea8;>GDT</span><span>: Once&LTgdt::Gdt> = Once::new();
</span></code></pre><p>The <code>Once</code> type allows us to initialize a <code>static</code> at runtime. It is safe because the only way to access the static value is through the provided methods (<a href=https://docs.rs/spin/0.4.5/spin/struct.Once.html#method.call_once>call_once</a>, <a href=https://docs.rs/spin/0.4.5/spin/struct.Once.html#method.try>try</a>, and <a href=https://docs.rs/spin/0.4.5/spin/struct.Once.html#method.wait>wait</a>). Thus, no value can be read before initialization and the value can only be initialized once.<p>(The <code>Once</code> was added in spin 0.4, so you‚Äôre probably need to update your spin dependency.)<p>So let‚Äôs rewrite our <code>interrupts::init</code> function to use the static <code>TSS</code> and <code>GDT</code>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>pub fn </span><span>init(memory_controller: </span><span style=color:#569cd6;>&mut</span><span> MemoryController) {
</span><span>    </span><span style=color:#569cd6;>let</span><span> double_fault_stack = memory_controller.alloc_stack(</span><span style=color:#b5cea8;>1</span><span>)
</span><span>        .expect(</span><span style=color:#d69d85;>"could not allocate double fault stack"</span><span>);
</span><span>
</span><span>    </span><span style=color:#569cd6;>let</span><span> tss = </span><span style=color:#b4cea8;>TSS</span><span>.call_once(|| {
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> tss = TaskStateSegment::new();
</span><span>        tss.interrupt_stack_table[</span><span style=color:#b4cea8;>DOUBLE_FAULT_IST_INDEX</span><span>] = VirtualAddress(
</span><span>            double_fault_stack.top());
</span><span>        tss
</span><span>    });
</span><span>
</span><span>    </span><span style=color:#569cd6;>let</span><span> gdt = </span><span style=color:#b4cea8;>GDT</span><span>.call_once(|| {
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> gdt = gdt::Gdt::new();
</span><span>        </span><span style=color:#569cd6;>let</span><span> code_selector = gdt.add_entry(gdt::Descriptor::
</span><span>                            kernel_code_segment());
</span><span>        </span><span style=color:#569cd6;>let</span><span> tss_selector = gdt.add_entry(gdt::Descriptor::tss_segment(</span><span style=color:#569cd6;>&</span><span>tss));
</span><span>        gdt
</span><span>    });
</span><span>    gdt.load();
</span><span>
</span><span>    </span><span style=color:#b4cea8;>IDT</span><span>.load();
</span><span>}
</span></code></pre><p>Now it should compile again!<h4 id=the-final-steps><a aria-label="Anchor link for: the-final-steps" class=zola-anchor href=#the-final-steps>üîó</a>The final Steps</h4><p>We‚Äôre almost done. We successfully loaded our new GDT, which contains a TSS descriptor. Now there are just a few steps left:<ol><li>We changed our GDT, so we should reload the <code>cs</code>, the code segment register. This required since the old segment selector could point a different GDT descriptor now (e.g. a TSS descriptor).<li>We loaded a GDT that contains a TSS selector, but we still need to tell the CPU that it should use that TSS.<li>As soon as our TSS is loaded, the CPU has access to a valid interrupt stack table (IST). Then we can tell the CPU that it should use our new double fault stack by modifying our double fault IDT entry.</ol><p>For the first two steps, we need access to the <code>code_selector</code> and <code>tss_selector</code> variables outside of the closure. We can achieve this by moving the <code>let</code> declarations out of the closure:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupts/mod.rs
</span><span style=color:#569cd6;>pub fn </span><span>init(memory_controller: </span><span style=color:#569cd6;>&mut</span><span> MemoryController) {
</span><span>    </span><span style=color:#569cd6;>use </span><span>x86_64::structures::gdt::SegmentSelector;
</span><span>    </span><span style=color:#569cd6;>use </span><span>x86_64::instructions::segmentation::set_cs;
</span><span>    </span><span style=color:#569cd6;>use </span><span>x86_64::instructions::tables::load_tss;
</span><span>    </span><span style=color:#569cd6;>...
</span><span>
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> code_selector = SegmentSelector(</span><span style=color:#b5cea8;>0</span><span>);
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> tss_selector = SegmentSelector(</span><span style=color:#b5cea8;>0</span><span>);
</span><span>    </span><span style=color:#569cd6;>let</span><span> gdt = </span><span style=color:#b4cea8;>GDT</span><span>.call_once(|| {
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> gdt = gdt::Gdt::new();
</span><span>        code_selector = gdt.add_entry(gdt::Descriptor::kernel_code_segment());
</span><span>        tss_selector = gdt.add_entry(gdt::Descriptor::tss_segment(</span><span style=color:#569cd6;>&</span><span>tss));
</span><span>        gdt
</span><span>    });
</span><span>    gdt.load();
</span><span>
</span><span>    </span><span style=color:#569cd6;>unsafe </span><span>{
</span><span>        </span><span style=color:#608b4e;>// reload code segment register
</span><span>        set_cs(code_selector);
</span><span>        </span><span style=color:#608b4e;>// load TSS
</span><span>        load_tss(tss_selector);
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#b4cea8;>IDT</span><span>.load();
</span><span>}
</span></code></pre><p>We first set the descriptors to <code>empty</code> and then update them from inside the closure (which implicitly borrows them as <code>&mut</code>). Now we‚Äôre able to reload the code segment register using <a href=https://docs.rs/x86_64/0.1.2/x86_64/instructions/segmentation/fn.set_cs.html><code>set_cs</code></a> and to load the TSS using <a href=https://docs.rs/x86_64/0.1.2/x86_64/instructions/tables/fn.load_tss.html><code>load_tss</code></a>.<p>Now that we loaded a valid TSS and interrupt stack table, we can set the stack index for our double fault handler in the IDT:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/interrupt/mod.rs
</span><span>
</span><span>lazy_static! {
</span><span>    </span><span style=color:#569cd6;>static ref </span><span style=color:#b4cea8;>IDT</span><span>: idt::Idt = {
</span><span>        </span><span style=color:#569cd6;>let mut</span><span> idt = idt::Idt::new();
</span><span>        </span><span style=color:#569cd6;>...
</span><span>        </span><span style=color:#569cd6;>unsafe </span><span>{
</span><span>            idt.double_fault.set_handler_fn(double_fault_handler)
</span><span>                .set_stack_index(</span><span style=color:#b4cea8;>DOUBLE_FAULT_IST_INDEX </span><span style=color:#569cd6;>as u16</span><span>);
</span><span>        }
</span><span>        </span><span style=color:#569cd6;>...
</span><span>    };
</span><span>}
</span></code></pre><p>The <code>set_stack_index</code> method is unsafe because the the caller must ensure that the used index is valid and not already used for another exception.<p>That‚Äôs it! Now the CPU should switch to the double fault stack whenever a double fault occurs. Thus, we are able to catch <em>all</em> double faults, including kernel stack overflows:<p><img alt="QEMU printing EXCEPTION: DOUBLE FAULT and a dump of the exception stack frame" src=qemu-double-fault-on-stack-overflow.png><p>From now on we should never see a triple fault again!<h2 id=what-s-next><a aria-label="Anchor link for: what-s-next" class=zola-anchor href=#what-s-next>üîó</a>What‚Äôs next?</h2><p>Now that we mastered exceptions, it‚Äôs time to explore another kind of interrupts: interrupts from external devices such as timers, keyboards, or network controllers. These hardware interrupts are very similar to exceptions, e.g. they are also dispatched through the IDT.<p>However, unlike exceptions, they don‚Äôt arise directly on the CPU. Instead, an <em>interrupt controller</em> aggregates these interrupts and forwards them to CPU depending on their priority. In the next posts we will explore the two interrupt controller variants on x86: the <a href=https://en.wikipedia.org/wiki/Intel_8259>Intel 8259</a> (‚ÄúPIC‚Äù) and the <a href=https://en.wikipedia.org/wiki/Advanced_Programmable_Interrupt_Controller>APIC</a>. This will allow us to react to keyboard and mouse input.</main><div><hr><div class=PageNavigation><a class=prev href=/handling-exceptions/>¬´ Handling Exceptions</a></div><hr><section><h2>Comments (Archived)</h2><section id=isso-thread><div id=isso-root><div class=isso-comment id=isso-270><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=3aa6c8ba212d shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Bla≈æ ≈†nuderl</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-270 rel=nofollow><time title="Mon Jan 09 2017 23:13:52 GMT+0100 (Central European Standard Time)" datetime=2017-00-01T22:13:52Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>Hey. This post seems to break returning from interruptions.<p>Eg. int!(3) produces a double fault while it returned correctly in the previous post<p>Aside from that, thanks for this series. It is superbly written with lots of useful info :)</div><div class=isso-comment-footer><span class=votes>3</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class=isso-comment id=isso-271><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-271 rel=nofollow><time title="Tue Jan 10 2017 22:22:50 GMT+0100 (Central European Standard Time)" datetime=2017-00-02T21:22:50Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>You're right, I don't know how I didn't notice this.<p>It seems like the problem is our new GDT, which doesn't have a data segment descriptor. This alone is fine, but the `ss` register still holds a value which is saved to the stack when an exception occurs and checked by `iretq` when we return. One possible solution is to load 0 into the `ss` register after entering long mode (null descriptors are explicitely allowed in `ss` in 64-bit mode). Another solution is to add a valid writable data segment to our new GDT.<p>This issue is tracked in <a href=https://github.com/phil-opp/blog_os/issues/277 rel=nofollow>#277</a> and I plan to fix it in the next few days. Thanks a lot for reporting!<p><blockquote>Aside from that, thanks for this series. It is superbly written with lots of useful info :)</blockquote><p><p>Thanks so much!</div><div class=isso-comment-footer><span class=votes>1</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class=isso-comment id=isso-272><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-272 rel=nofollow><time title="Sat Jan 14 2017 15:58:36 GMT+0100 (Central European Standard Time)" datetime=2017-00-06T14:58:36Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>For all people that have the same problem:<p>The problem is that the <code>ss</code> segment register still contains a selector of the previous GDT that is no longer valid. The <code>iretq</code> instruction expects a valid data segment selector or a null selector. So the easiest way to fix this problem is to add the following to the <code>long_mode_init.asm</code>:<p><pre><code>long_mode_start:<br>    ; load 0 into all data segment registers<br>    mov ax, 0<br>    mov ss, ax<br>    mov ds, ax<br>    mov es, ax<br>    mov fs, ax<br>    mov gs, ax<br></code></pre><p><p>(You only need to reload <code>ss</code>. However, the other registers also no longer point to valid data segments, so it's cleaner to invalidate them, too.)</div><div class=isso-comment-footer><span class=votes>1</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-273><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=d2c4b1a4c20e shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>boomshroom</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-273 rel=nofollow><time title="Fri Jan 20 2017 18:07:29 GMT+0100 (Central European Standard Time)" datetime=2017-00-05T17:07:29Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>I just asked on the irc because this seemed like it could be possible with lifetimes. They suggested using PhantomData to add a lifetime parameter to the index and the stack pointers could be replaced by Option<&_>, which is easily obtained by an as_ref() method on a raw pointer.<p>The biggest issue here is verifying that the Option is the correct size.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-274><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-274 rel=nofollow><time title="Sat Jan 21 2017 16:47:41 GMT+0100 (Central European Standard Time)" datetime=2017-00-06T15:47:41Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p><blockquote>The biggest issue here is verifying that the Option is the correct size.</blockquote><p><p>As far as I know, an <code>Option<&X></code> has always the same size as a <code>&X</code>, since references implement the <a href=https://doc.rust-lang.org/1.10.0/core/nonzero/struct.NonZero.html rel=nofollow>the NonZero trait</a>. We could also use a <code>struct StackPointer(usize)</code> and implement <code>NonZero</code> for it. Then an <code>Option&LTstackpointer></code> has the same size as an <code>usize</code>.<p>However, I don't think that it suffices to add a lifetime parameter to the index. For example, we could create two static TSSs A and B. Now we can load TSS A in the CPU but use an index from TSS B in our IDT.<p></div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-410><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=4609155c40c7 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Anonym</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-410 rel=nofollow><time title="Fri Jul 27 2018 08:05:31 GMT+0200 (Central European Summer Time)" datetime=2018-06-05T06:05:31Z>vor 5 Monaten</time></a><span class=note></span></div><div class=text><p>sdf</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-411><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=4609155c40c7 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Anonym</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-411 rel=nofollow><time title="Fri Jul 27 2018 08:05:32 GMT+0200 (Central European Summer Time)" datetime=2018-06-05T06:05:32Z>vor 5 Monaten</time></a><span class=note></span></div><div class=text><p>sdf</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-275><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=046dc8da1607 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Ekin</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-275 rel=nofollow><time title="Sat Feb 11 2017 21:56:15 GMT+0100 (Central European Standard Time)" datetime=2017-01-06T20:56:15Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>Thank you for series. It is great</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-282><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=250647bcaa0e shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Rajivteja Nagipogu</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-282 rel=nofollow><time title="Wed Apr 05 2017 16:43:51 GMT+0200 (Central European Summer Time)" datetime=2017-03-03T14:43:51Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>Hi Phill sir. I implemented the OS following the blog till here. So, I was trying to implement system calls to the OS. I tried to use the "syscall" crate and implement a "write" syscall but it caused a Double fault. Is this due to the page fault? Here is the stack frame<p>IP : 0x110e43<br>code_segment : 8 <br>cpu_flags : 0x200006<br>stack_pointer : 0x121dd0<br>stack_segment : 0<p>Guard page is at 0x11b000</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-283><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-283 rel=nofollow><time title="Mon Apr 17 2017 12:27:22 GMT+0200 (Central European Summer Time)" datetime=2017-03-01T10:27:22Z>vor 2 Jahren</time></a><span class=note></span></div><div class=text><p>The problem might be that you didn't define a handler function for the syscall interrupt or that the privilege level of the IDT entry doesn't allow invokations from userland. In that case, a general protection exception occurs. If you didn't define a handler for this exception, it causes a double fault.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-318><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=a9976a1ee425 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=20></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>boris</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-318 rel=nofollow><time title="Tue Aug 08 2017 15:54:13 GMT+0200 (Central European Summer Time)" datetime=2017-07-02T13:54:13Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Very interesting series, thank you. Please feel free to add some sort of subscriber feed (RSS,Atom,..)! If there is one, Firefox didn't find it. Haven't tried inoreader yet.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-331><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=5db23f819f9f shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-331 rel=nofollow><time title="Thu Oct 19 2017 09:10:57 GMT+0200 (Central European Summer Time)" datetime=2017-09-04T07:10:57Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>There should be a feed at <a href=https://os.phil-opp.com/rss.xml rel=nofollow>https://os.phil-opp.com/rss.xml</a></div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-324><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=5bf6062ae985 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=4></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=12></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=12></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=4></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Nitin John</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-324 rel=nofollow><time title="Thu Oct 05 2017 12:36:51 GMT+0200 (Central European Summer Time)" datetime=2017-09-04T10:36:51Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Hey! I've been going through your blog, and I think it's splendidly written. I was wondering when the next post would be out</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-332><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=5db23f819f9f shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-332 rel=nofollow><time title="Thu Oct 19 2017 09:26:37 GMT+0200 (Central European Summer Time)" datetime=2017-09-04T07:26:37Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Thanks a lot! I'm currently working on a second edition of this blog, which reorders the posts (exceptions before page tables) and uses an own bootloader. So the plan is to rewrite the earlier posts, reuse the posts about exceptions, and then write some new posts about hardware interrupts and keyboard input.<p>I created <a href=https://github.com/phil-opp/blog_os/issues/360 rel=nofollow>an issue</a> to track this.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-327><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=4bf934fd5497 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Anonym</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-327 rel=nofollow><time title="Wed Oct 18 2017 12:50:54 GMT+0200 (Central European Summer Time)" datetime=2017-09-03T10:50:54Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Waiting next..... :)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-344><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=42990e8ca6a4 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Anonym</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-344 rel=nofollow><time title="Wed Nov 22 2017 12:44:24 GMT+0100 (Central European Standard Time)" datetime=2017-10-03T11:44:24Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>thanks</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-375><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=169fa9bde6a2 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #e279a3" height=8 width=8 x=4 y=12></rect><rect style="fill: #e279a3" height=8 width=8 x=36 y=12></rect><rect style="fill: #e279a3" height=8 width=8 x=4 y=20></rect><rect style="fill: #e279a3" height=8 width=8 x=36 y=20></rect><rect style="fill: #e279a3" height=8 width=8 x=4 y=28></rect><rect style="fill: #e279a3" height=8 width=8 x=36 y=28></rect><rect style="fill: #e279a3" height=8 width=8 x=4 y=36></rect><rect style="fill: #e279a3" height=8 width=8 x=36 y=36></rect><rect style="fill: #e279a3" height=8 width=8 x=12 y=20></rect><rect style="fill: #e279a3" height=8 width=8 x=28 y=20></rect><rect style="fill: #e279a3" height=8 width=8 x=12 y=28></rect><rect style="fill: #e279a3" height=8 width=8 x=28 y=28></rect><rect style="fill: #e279a3" height=8 width=8 x=20 y=4></rect><rect style="fill: #e279a3" height=8 width=8 x=20 y=20></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Anonym</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-375 rel=nofollow><time title="Fri Jan 26 2018 18:55:42 GMT+0100 (Central European Standard Time)" datetime=2018-00-05T17:55:42Z>vor 11 Monaten</time></a><span class=note></span></div><div class=text><p>Are you running your own blog post ? i've reading it the first half and already want to point out, this is all i need from such a great programmer. Otherways i would have asked my boss for such a course, but i think this can bring me to the path i wanted, i am a webdeveloper and want to serve json files on the internet. But to be ISO 27001 compliant i needed this information...</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class=isso-comment id=isso-378><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=43283234a1a3 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9163b6" height=8 width=8 x=4 y=20></rect><rect style="fill: #9163b6" height=8 width=8 x=36 y=20></rect><rect style="fill: #9163b6" height=8 width=8 x=4 y=36></rect><rect style="fill: #9163b6" height=8 width=8 x=36 y=36></rect><rect style="fill: #9163b6" height=8 width=8 x=12 y=36></rect><rect style="fill: #9163b6" height=8 width=8 x=28 y=36></rect><rect style="fill: #9163b6" height=8 width=8 x=20 y=4></rect><rect style="fill: #9163b6" height=8 width=8 x=20 y=20></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-378 rel=nofollow><time title="Sun Jan 28 2018 15:19:04 GMT+0100 (Central European Standard Time)" datetime=2018-00-00T14:19:04Z>vor 11 Monaten</time></a><span class=note></span></div><div class=text><blockquote>Are you running your own blog post ?</blockquote><p>Sorry, I don't understand what you mean.</div><div class=isso-comment-footer><span class=votes>-1</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-385><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=dc10e66e492c shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Arbel</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-385 rel=nofollow><time title="Thu Feb 22 2018 22:28:12 GMT+0100 (Central European Standard Time)" datetime=2018-01-04T21:28:12Z>vor 10 Monaten</time></a><span class=note></span></div><div class=text><p>Wanted to share a project I am working on, I started from this awesome blog! <a href=https://github.com/arbel03/os rel=nofollow>https://github.com/arbel03/os</a></div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-387><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c8fed02ed154 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-387 rel=nofollow><time title="Fri Feb 23 2018 19:02:44 GMT+0100 (Central European Standard Time)" datetime=2018-01-05T18:02:44Z>vor 10 Monaten</time></a><span class=note></span></div><div class=text><p>Looks like you created your own bootloader and already have some kind of filesystem. Really cool!<p>We have just created the <a href=https://github.com/rust-osdev rel=nofollow>rust-osdev</a> organization on Github, where we plan to host and maintain all kinds of libraries needed for OS development in Rust (e.g. the x86_64 crate, a bootloader, etc.). Let me know if you'd like to become a member, maybe we can join forces.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-404><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c46639a36f86 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=4></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=4></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=20 y=4></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta>Dan Cross<span class=spacer>‚Ä¢</span><a class=permalink href=#isso-404 rel=nofollow><time title="Wed Jun 06 2018 22:54:19 GMT+0200 (Central European Summer Time)" datetime=2018-05-03T20:54:19Z>vor 7 Monaten</time></a><span class=note></span></div><div class=text><p>Sadly, this appears to no longer compile, as some of the dependencies are now rather different and some language features have changed. I know you're busy with the second edition effort, but is there any chance there are updates waiting in the wings to the first edition parts?</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-407><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c8fed02ed154 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-407 rel=nofollow><time title="Sun Jun 10 2018 11:10:45 GMT+0200 (Central European Summer Time)" datetime=2018-05-00T09:10:45Z>vor 7 Monaten</time></a><span class=note></span></div><div class=text><p>Sorry, I don't have the time to keep the first version up to date. I try my best to incorporate the first edition posts into the second edition soon, but it will take some time.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-408><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c46639a36f86 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=4></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=4></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=4 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=36 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=12></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=20></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=28></rect><rect style="fill: #e4bf80" height=8 width=8 x=12 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=28 y=36></rect><rect style="fill: #e4bf80" height=8 width=8 x=20 y=4></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta>Dan Cross<span class=spacer>‚Ä¢</span><a class=permalink href=#isso-408 rel=nofollow><time title="Mon Jun 11 2018 16:31:00 GMT+0200 (Central European Summer Time)" datetime=2018-05-01T14:31:00Z>vor 7 Monaten</time></a><span class=note></span></div><div class=text><p>I understand. It's a great service to the community that this exists at all; would you accept pull requests to fix code while the second edition is still being prepared?</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-409><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=5db23f819f9f shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-409 rel=nofollow><time title="Mon Jun 11 2018 17:10:58 GMT+0200 (Central European Summer Time)" datetime=2018-05-01T15:10:58Z>vor 7 Monaten</time></a><span class=note></span></div><div class=text><p>Sure!</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div></div></section></section></div><footer class=footer><hr><small> ¬© <time datetime=2017>2017</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer></div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>