<!doctype html><html lang=en><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code." name=description><meta content="Philipp Oppermann" name=author><link href=/css/edition-1/poole.css rel=stylesheet><link href=/css/edition-1/main.css rel=stylesheet><link href=/css/edition-1/isso.css rel=stylesheet><script async src=/js/edition-1/main.js></script><title>Allocating Frames | Writing an OS in Rust (First Edition)</title><body><div class="container content"><header class=masthead><h2 class=masthead-title><a href=/edition-1 title=Home>Writing an OS in Rust (First Edition)</a></h2><p><small>Philipp¬†Oppermann's¬†blog</small></header><main><h1>Allocating Frames</h1><time class=post-date datetime=2015-11-15> Nov 15, 2015 </time><aside id=toc-aside><h2>Table of Contents</h2><ol><li><a href=#preparation>Preparation</a><li><a href=#the-multiboot-information-structure>The Multiboot Information Structure</a> <ol><li><a href=#available-memory>Available Memory</a><li><a href=#handling-panics>Handling Panics</a><li><a href=#kernel-elf-sections>Kernel ELF Sections</a><li><a href=#start-and-end-of-kernel>Start and End of Kernel</a></ol><li><a href=#a-frame-allocator>A frame allocator</a> <ol><li><a href=#a-memory-module>A Memory Module</a><li><a href=#the-allocator>The Allocator</a><li><a href=#testing-it>Testing it</a></ol><li><a href=#conclusion>Conclusion</a><li><a href=#what-s-next>What‚Äôs next?</a><li><a href=#recommended-posts>Recommended Posts</a></ol></aside><div class=warning><b>No longer updated!</b> You are viewing the a post of the first edition of ‚ÄúWriting an OS in Rust‚Äù, which is no longer updated. You can find the second edition <a href=https://os.phil-opp.com/edition-2/>here</a>.</div><p>In this post we create an allocator that provides free physical frames for a future paging module. To get the required information about available and used memory we use the Multiboot information structure. Additionally, we improve the <code>panic</code> handler to print the corresponding message and source line.</p><span id=continue-reading></span><p>The full source code is available on <a href=https://github.com/phil-opp/blog_os/tree/first_edition_post_5>GitHub</a>. Feel free to open issues there if you have any problems or improvements. You can also leave a comment at the bottom.<h2 id=preparation><a aria-label="Anchor link for: preparation" class=zola-anchor href=#preparation>üîó</a>Preparation</h2><p>We still have a really tiny stack of 64 bytes, which won‚Äôt suffice for this post. So we increase it to 16kB (four pages) in <code>boot.asm</code>:<pre class=language-asm data-lang=asm style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-asm data-lang=asm><span>section .bss
</span><span>...
</span><span>stack_bottom:
</span><span>    resb </span><span style=color:#b4cea8;>4096 </span><span>* </span><span style=color:#b4cea8;>4
</span><span>stack_top:
</span></code></pre><h2 id=the-multiboot-information-structure><a aria-label="Anchor link for: the-multiboot-information-structure" class=zola-anchor href=#the-multiboot-information-structure>üîó</a>The Multiboot Information Structure</h2><p>When a Multiboot compliant bootloader loads a kernel, it passes a pointer to a boot information structure in the <code>ebx</code> register. We can use it to get information about available memory and loaded kernel sections.<p>First, we need to pass this pointer to our kernel as an argument to <code>rust_main</code>. To find out how arguments are passed to functions, we can look at the <a href=https://en.wikipedia.org/wiki/X86_calling_conventions#System_V_AMD64_ABI>calling convention of Linux</a>:<blockquote><p>The first six integer or pointer arguments are passed in registers RDI, RSI, RDX, RCX, R8, and R9</blockquote><p>So to pass the pointer to our kernel, we need to move it to <code>rdi</code> before calling the kernel. Since we‚Äôre not using the <code>rdi</code>/<code>edi</code> register in our bootstrap code, we can simply set the <code>edi</code> register right after booting (in <code>boot.asm</code>):<pre class=language-nasm data-lang=nasm style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-nasm data-lang=nasm><span>start:
</span><span>    </span><span style=color:#569cd6;>mov </span><span>esp, stack_top
</span><span>    </span><span style=color:#569cd6;>mov </span><span>edi, ebx</span><span style=color:#608b4e;>       ; Move Multiboot info pointer to edi
</span></code></pre><p>Now we can add the argument to our <code>rust_main</code>:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>pub extern fn </span><span>rust_main(multiboot_information_address: </span><span style=color:#569cd6;>usize</span><span>) { </span><span style=color:#569cd6;>... </span><span>}
</span></code></pre><p>Instead of writing an own Multiboot module, we use the <a href=https://docs.rs/multiboot2>multiboot2</a> crate. It gives us some basic information about mapped kernel sections and available memory. I just wrote it for this blog post since I could not find any other Multiboot 2 crate. It‚Äôs still incomplete, but it does its job.<p>So let‚Äôs add a dependency on the git repository:<pre class=language-toml data-lang=toml style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-toml data-lang=toml><span style=color:#608b4e;># in Cargo.toml
</span><span>[</span><span style=color:#808080;>dependencies</span><span>]
</span><span style=color:#ff3333;>...
</span><span style=color:#569cd6;>multiboot2 </span><span>= </span><span style=color:#d69d85;>"0.1.0"
</span></code></pre><pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in src/lib.rs
</span><span style=color:#569cd6;>extern crate</span><span> multiboot2;
</span></code></pre><p>Now we can use it to print available memory areas.<h3 id=available-memory><a aria-label="Anchor link for: available-memory" class=zola-anchor href=#available-memory>üîó</a>Available Memory</h3><p>The boot information structure consists of various <em>tags</em>. See section 3.4 of the Multiboot specification (<a href=https://nongnu.askapache.com/grub/phcoder/multiboot.pdf>PDF</a>) for a complete list. The <em>memory map</em> tag contains a list of all available RAM areas. Special areas such as the VGA text buffer at <code>0xb8000</code> are not available. Note that some of the available memory is already used by our kernel and by the multiboot information structure itself.<p>To print all available memory areas, we can use the <code>multiboot2</code> crate in our <code>rust_main</code> as follows:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>let</span><span> boot_info = </span><span style=color:#569cd6;>unsafe</span><span>{ multiboot2::load(multiboot_information_address) };
</span><span style=color:#569cd6;>let</span><span> memory_map_tag = boot_info.memory_map_tag()
</span><span>    .expect(</span><span style=color:#d69d85;>"Memory map tag required"</span><span>);
</span><span>
</span><span>println!(</span><span style=color:#d69d85;>"memory areas:"</span><span>);
</span><span style=color:#569cd6;>for</span><span> area </span><span style=color:#569cd6;>in</span><span> memory_map_tag.memory_areas() {
</span><span>    println!(</span><span style=color:#d69d85;>"    start: 0x</span><span style=color:#b4cea8;>{:x}</span><span style=color:#d69d85;>, length: 0x</span><span style=color:#b4cea8;>{:x}</span><span style=color:#d69d85;>"</span><span>,
</span><span>        area.base_addr, area.length);
</span><span>}
</span></code></pre><p>The <code>load</code> function is <code>unsafe</code> because it relies on a valid address. Since the memory tag is not required by the Multiboot specification, the <code>memory_map_tag()</code> function returns an <code>Option</code>. The <code>memory_areas()</code> function returns the desired memory area iterator.<p>The output looks like this:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>Hello World!
</span><span>memory areas:
</span><span>    start: 0x0, length: 0x9fc00
</span><span>    start: 0x100000, length: 0x7ee0000
</span></code></pre><p>So we have one area from <code>0x0</code> to <code>0x9fc00</code>, which is a bit below the 1MiB mark. The second, bigger area starts at 1MiB and contains the rest of available memory. The area from <code>0x9fc00</code> to 1MiB is not available since it contains for example the VGA text buffer at <code>0xb8000</code>. This is the reason for putting our kernel at 1MiB and not somewhere below.<p>If you give QEMU more than 4GiB of memory by passing <code>-m 5G</code>, you get another unusable area below the 4GiB mark. This memory is normally mapped to some hardware devices. See the <a href=https://wiki.osdev.org/Memory_Map_(x86)>OSDev Wiki</a> for more information.<h3 id=handling-panics><a aria-label="Anchor link for: handling-panics" class=zola-anchor href=#handling-panics>üîó</a>Handling Panics</h3><p>We used <code>expect</code> in the code above, which will panic if there is no memory map tag. But our current panic handler just loops without printing any error message. Of course we could replace <code>expect</code> by a <code>match</code>, but we should fix the panic handler nonetheless:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span>#[lang </span><span style=color:#569cd6;>= </span><span style=color:#d69d85;>"panic_fmt"</span><span>]
</span><span>#[no_mangle]
</span><span style=color:#569cd6;>pub extern fn </span><span>panic_fmt() -> </span><span style=color:#569cd6;>! </span><span>{
</span><span>    println!(</span><span style=color:#d69d85;>"PANIC"</span><span>);
</span><span>    </span><span style=color:#569cd6;>loop</span><span>{}
</span><span>}
</span></code></pre><p>Now we get a <code>PANIC</code> message. But we can do even better. The <code>panic_fmt</code> function has actually some arguments:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span>#[lang </span><span style=color:#569cd6;>= </span><span style=color:#d69d85;>"panic_fmt"</span><span>]
</span><span>#[no_mangle]
</span><span style=color:#569cd6;>pub extern fn </span><span>panic_fmt(fmt: core::fmt::Arguments, file: </span><span style=color:#569cd6;>&'static str</span><span>,
</span><span>    line: </span><span style=color:#569cd6;>u32</span><span>) -> </span><span style=color:#569cd6;>!
</span><span>{
</span><span>    println!(</span><span style=color:#d69d85;>"</span><span style=color:#e3bbab;>\n\n</span><span style=color:#d69d85;>PANIC in </span><span style=color:#b4cea8;>{}</span><span style=color:#d69d85;> at line </span><span style=color:#b4cea8;>{}</span><span style=color:#d69d85;>:"</span><span>, file, line);
</span><span>    println!(</span><span style=color:#d69d85;>"    </span><span style=color:#b4cea8;>{}</span><span style=color:#d69d85;>"</span><span>, fmt);
</span><span>    </span><span style=color:#569cd6;>loop</span><span>{}
</span><span>}
</span></code></pre><p>Be careful with these arguments as the compiler does not check the function signature for <code>lang_items</code>.<p>Now we get the panic message and the causing source line. You can try it by inserting a <code>panic</code> somewhere.<h3 id=kernel-elf-sections><a aria-label="Anchor link for: kernel-elf-sections" class=zola-anchor href=#kernel-elf-sections>üîó</a>Kernel ELF Sections</h3><p>To read and print the sections of our kernel ELF file, we can use the <em>Elf-sections</em> tag:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>let</span><span> elf_sections_tag = boot_info.elf_sections_tag()
</span><span>    .expect(</span><span style=color:#d69d85;>"Elf-sections tag required"</span><span>);
</span><span>
</span><span>println!(</span><span style=color:#d69d85;>"kernel sections:"</span><span>);
</span><span style=color:#569cd6;>for</span><span> section </span><span style=color:#569cd6;>in</span><span> elf_sections_tag.sections() {
</span><span>    println!(</span><span style=color:#d69d85;>"    addr: 0x</span><span style=color:#b4cea8;>{:x}</span><span style=color:#d69d85;>, size: 0x</span><span style=color:#b4cea8;>{:x}</span><span style=color:#d69d85;>, flags: 0x</span><span style=color:#b4cea8;>{:x}</span><span style=color:#d69d85;>"</span><span>,
</span><span>        section.addr, section.size, section.flags);
</span><span>}
</span></code></pre><p>This should print out the start address and size of all kernel sections. If the section is writable, the <code>0x1</code> bit is set in <code>flags</code>. The <code>0x4</code> bit marks an executable section and the <code>0x2</code> bit indicates that the section was loaded in memory. For example, the <code>.text</code> section is executable but not writable and the <code>.data</code> section just the opposite.<p>But when we execute it, tons of really small sections are printed. We can use the <code>objdump -h build/kernel-x86_64.bin</code> command to list the sections with name. There seem to be over 200 sections and many of them start with <code>.text.*</code> or <code>.data.rel.ro.local.*</code>. This is because the Rust compiler puts e.g. each function in its own <code>.text</code> subsection. That way, unused functions are removed when the linker omits unused sections.<p>To merge these subsections, we need to update our linker script:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>ENTRY(start)
</span><span>
</span><span>SECTIONS {
</span><span>    . = 1M;
</span><span>
</span><span>    .boot :
</span><span>    {
</span><span>        KEEP(*(.multiboot_header))
</span><span>    }
</span><span>
</span><span>    .text :
</span><span>    {
</span><span>        *(.text .text.*)
</span><span>    }
</span><span>
</span><span>    .rodata : {
</span><span>        *(.rodata .rodata.*)
</span><span>    }
</span><span>
</span><span>    .data.rel.ro : {
</span><span>        *(.data.rel.ro.local*) *(.data.rel.ro .data.rel.ro.*)
</span><span>    }
</span><span>}
</span></code></pre><p>These lines are taken from the default linker script of <code>ld</code>, which can be obtained through <code>ld¬†‚Äëverbose</code>. The <code>.text</code> <em>output</em> section contains now all <code>.text.*</code> <em>input</em> sections of the static library (and the same applies for the <code>.rodata</code> and <code>.data.rel.ro</code> sections).<p>Now there are only 12 sections left and we get a much more useful output:<p><img alt="qemu output" src=qemu-memory-areas-and-kernel-sections.png><p>If you like, you can compare this output to the <code>objdump -h build/kernel-x86_64.bin</code> output. You will see that the start addresses and sizes match exactly for each section. The sections with flags <code>0x0</code> are mostly debug sections, so they don‚Äôt need to be loaded. And the last few sections of the QEMU output aren‚Äôt in the <code>objdump</code> output because they are special sections such as string tables.<h3 id=start-and-end-of-kernel><a aria-label="Anchor link for: start-and-end-of-kernel" class=zola-anchor href=#start-and-end-of-kernel>üîó</a>Start and End of Kernel</h3><p>We can now use the ELF section tag to calculate the start and end address of our loaded kernel:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>let</span><span> kernel_start = elf_sections_tag.sections().map(|s| s.addr)
</span><span>    .min().unwrap();
</span><span style=color:#569cd6;>let</span><span> kernel_end = elf_sections_tag.sections().map(|s| s.addr + s.size)
</span><span>    .max().unwrap();
</span></code></pre><p>The other used memory area is the Multiboot Information structure:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>let</span><span> multiboot_start = multiboot_information_address;
</span><span style=color:#569cd6;>let</span><span> multiboot_end = multiboot_start + (boot_info.total_size </span><span style=color:#569cd6;>as usize</span><span>);
</span></code></pre><p>Printing these numbers gives us:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>kernel_start: 0x100000, kernel_end: 0x11a168
</span><span>multiboot_start: 0x11d400, multiboot_end: 0x11d9c8
</span></code></pre><p>So the kernel starts at 1MiB (like expected) and is about 105 KiB in size. The multiboot information structure was placed at <code>0x11d400</code> by GRUB and needs 1480 bytes. Of course your numbers could be a bit different due to different versions of Rust or GRUB (or some differences in the source code).<h2 id=a-frame-allocator><a aria-label="Anchor link for: a-frame-allocator" class=zola-anchor href=#a-frame-allocator>üîó</a>A frame allocator</h2><p>When using paging, the physical memory is split into equally sized chunks (normally 4096 bytes) Such a chunk is called ‚Äúphysical page‚Äù or ‚Äúframe‚Äù. These frames can be mapped to any virtual page through page tables. For more information about paging take a peek at the <a href=https://os.phil-opp.com/page-tables/>next post</a>.<p>We will need a free frame in many cases. For example when want to increase the size of our future kernel heap. Or when we create a new page table. Or when we add a new kernel thread and thus need to allocate a new stack. So we need some kind of allocator that keeps track of physical frames and gives us a free one when needed.<p>There are various ways to write such a frame allocator:<p>We could create some kind of linked list from the free frames. For example, each frame could begin with a pointer to the next free frame. Since the frames are free, this would not overwrite any data. Our allocator would just save the head of the list and could easily allocate and deallocate frames by updating pointers. Unfortunately, this approach has a problem: It requires reading and writing these free frames. So we would need to map all physical frames to some virtual address, at least temporary. Another disadvantage is that we need to create this linked list at startup. That implies that we need to set over one million pointers at startup if the machine has 4GiB of RAM.<p>Another approach is to create some kind of data structure such as a <a href=https://wiki.osdev.org/Page_Frame_Allocation#Physical_Memory_Allocators>bitmap or a stack</a> to manage free frames. We could place it in the already identity mapped area right behind the kernel or multiboot structure. That way we would not need to (temporary) map each free frame. But it has the same problem of the slow initial creating/filling. In fact, we will use this approach in a future post to manage frames that are freed again. But for the initial management of free frames, we use a different method.<p>In the following, we will use Multiboot‚Äôs memory map directly. The idea is to maintain a simple counter that starts at frame 0 and is increased constantly. If the current frame is available (part of an available area in the memory map) and not used by the kernel or the multiboot structure (we know their start and end addresses), we know that it‚Äôs free and return it. Else, we increase the counter to the next possibly free frame. That way, we don‚Äôt need to create a data structure when booting and the physical frames can remain unmapped. The only problem is that we cannot reasonably free frames again, but we will solve that problem in a future post (by adding an intermediate frame stack that saves freed frames).<p>So let‚Äôs start implementing our memory map based frame allocator.<h3 id=a-memory-module><a aria-label="Anchor link for: a-memory-module" class=zola-anchor href=#a-memory-module>üîó</a>A Memory Module</h3><p>First we create a memory module with a <code>Frame</code> type (<code>src/memory/mod.rs</code>):<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span>#[derive(Debug, PartialEq, Eq, PartialOrd, Ord)]
</span><span style=color:#569cd6;>pub struct </span><span>Frame {
</span><span>    number: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>}
</span></code></pre><p>(Don‚Äôt forget to add the <code>mod memory</code> line to <code>src/lib.rs</code>.) Instead of e.g. the start address, we just store the frame number. We use <code>usize</code> here since the number of frames depends on the memory size. The long <code>derive</code> line makes frames printable and comparable.<p>To make it easy to get the corresponding frame for a physical address, we add a <code>containing_address</code> method:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>pub const </span><span style=color:#b4cea8;>PAGE_SIZE</span><span>: </span><span style=color:#569cd6;>usize </span><span>= </span><span style=color:#b5cea8;>4096</span><span>;
</span><span>
</span><span style=color:#569cd6;>impl </span><span>Frame {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>containing_address(address: </span><span style=color:#569cd6;>usize</span><span>) -> Frame {
</span><span>        Frame{ number: address / </span><span style=color:#b4cea8;>PAGE_SIZE </span><span>}
</span><span>    }
</span><span>}
</span></code></pre><p>We also add a <code>FrameAllocator</code> trait:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>pub trait </span><span>FrameAllocator {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>allocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self) -> Option&LTFrame>;
</span><span>    </span><span style=color:#569cd6;>fn </span><span>deallocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self, frame: Frame);
</span><span>}
</span></code></pre><p>This allows us to create another, more advanced frame allocator in the future.<h3 id=the-allocator><a aria-label="Anchor link for: the-allocator" class=zola-anchor href=#the-allocator>üîó</a>The Allocator</h3><p>Now we can put everything together and create the actual frame allocator. Therefor we create a <code>src/memory/area_frame_allocator.rs</code> submodule. The allocator struct looks like this:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>use </span><span>memory::{Frame, FrameAllocator};
</span><span style=color:#569cd6;>use </span><span>multiboot2::{MemoryAreaIter, MemoryArea};
</span><span>
</span><span style=color:#569cd6;>pub struct </span><span>AreaFrameAllocator {
</span><span>    next_free_frame: Frame,
</span><span>    current_area: Option<</span><span style=color:#569cd6;>&'static</span><span> MemoryArea>,
</span><span>    areas: MemoryAreaIter,
</span><span>    kernel_start: Frame,
</span><span>    kernel_end: Frame,
</span><span>    multiboot_start: Frame,
</span><span>    multiboot_end: Frame,
</span><span>}
</span></code></pre><p>The <code>next_free_frame</code> field is a simple counter that is increased every time we return a frame. It‚Äôs initialized to <code>0</code> and every frame below it counts as used. The <code>current_area</code> field holds the memory area that contains <code>next_free_frame</code>. If <code>next_free_frame</code> leaves this area, we will look for the next one in <code>areas</code>. When there are no areas left, all frames are used and <code>current_area</code> becomes <code>None</code>. The <code>{kernel, multiboot}_{start, end}</code> fields are used to avoid returning already used fields.<p>To implement the <code>FrameAllocator</code> trait, we need to implement the allocation and deallocation methods:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>impl </span><span>FrameAllocator </span><span style=color:#569cd6;>for </span><span>AreaFrameAllocator {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>allocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self) -> Option&LTFrame> {
</span><span>        </span><span style=color:#608b4e;>// TODO (see below)
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#569cd6;>fn </span><span>deallocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self, frame: Frame) {
</span><span>        </span><span style=color:#608b4e;>// TODO (see below)
</span><span>    }
</span><span>}
</span></code></pre><p>The <code>allocate_frame</code> method looks like this:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in `allocate_frame` in `impl FrameAllocator for AreaFrameAllocator`
</span><span>
</span><span style=color:#569cd6;>if let </span><span>Some(area) = self.current_area {
</span><span>    </span><span style=color:#608b4e;>// "Clone" the frame to return it if it's free. Frame doesn't
</span><span>    </span><span style=color:#608b4e;>// implement Clone, but we can construct an identical frame.
</span><span>    </span><span style=color:#569cd6;>let</span><span> frame = Frame{ number: self.next_free_frame.number };
</span><span>
</span><span>    </span><span style=color:#608b4e;>// the last frame of the current area
</span><span>    </span><span style=color:#569cd6;>let</span><span> current_area_last_frame = {
</span><span>        </span><span style=color:#569cd6;>let</span><span> address = area.base_addr + area.length - </span><span style=color:#b5cea8;>1</span><span>;
</span><span>        Frame::containing_address(address </span><span style=color:#569cd6;>as usize</span><span>)
</span><span>    };
</span><span>
</span><span>    </span><span style=color:#569cd6;>if</span><span> frame > current_area_last_frame {
</span><span>        </span><span style=color:#608b4e;>// all frames of current area are used, switch to next area
</span><span>        self.choose_next_area();
</span><span>    } </span><span style=color:#569cd6;>else if</span><span> frame >= self.kernel_start </span><span style=color:#569cd6;>&&</span><span> frame <= self.kernel_end {
</span><span>        </span><span style=color:#608b4e;>// `frame` is used by the kernel
</span><span>        self.next_free_frame = Frame {
</span><span>            number: self.kernel_end.number + </span><span style=color:#b5cea8;>1
</span><span>        };
</span><span>    } </span><span style=color:#569cd6;>else if</span><span> frame >= self.multiboot_start </span><span style=color:#569cd6;>&&</span><span> frame <= self.multiboot_end {
</span><span>        </span><span style=color:#608b4e;>// `frame` is used by the multiboot information structure
</span><span>        self.next_free_frame = Frame {
</span><span>            number: self.multiboot_end.number + </span><span style=color:#b5cea8;>1
</span><span>        };
</span><span>    } </span><span style=color:#569cd6;>else </span><span>{
</span><span>        </span><span style=color:#608b4e;>// frame is unused, increment `next_free_frame` and return it
</span><span>        self.next_free_frame.number += </span><span style=color:#b5cea8;>1</span><span>;
</span><span>        </span><span style=color:#569cd6;>return </span><span>Some(frame);
</span><span>    }
</span><span>    </span><span style=color:#608b4e;>// `frame` was not valid, try it again with the updated `next_free_frame`
</span><span>    self.allocate_frame()
</span><span>} </span><span style=color:#569cd6;>else </span><span>{
</span><span>    None </span><span style=color:#608b4e;>// no free frames left
</span><span>}
</span></code></pre><p>The <code>choose_next_area</code> method isn‚Äôt part of the trait and thus goes into a new <code>impl¬†AreaFrameAllocator</code> block:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#608b4e;>// in `impl AreaFrameAllocator`
</span><span>
</span><span style=color:#569cd6;>fn </span><span>choose_next_area(</span><span style=color:#569cd6;>&mut </span><span>self) {
</span><span>    self.current_area = self.areas.clone().filter(|area| {
</span><span>        </span><span style=color:#569cd6;>let</span><span> address = area.base_addr + area.length - </span><span style=color:#b5cea8;>1</span><span>;
</span><span>        Frame::containing_address(address </span><span style=color:#569cd6;>as usize</span><span>) >= self.next_free_frame
</span><span>    }).min_by_key(|area| area.base_addr);
</span><span>
</span><span>    </span><span style=color:#569cd6;>if let </span><span>Some(area) = self.current_area {
</span><span>        </span><span style=color:#569cd6;>let</span><span> start_frame = Frame::containing_address(area.base_addr </span><span style=color:#569cd6;>as usize</span><span>);
</span><span>        </span><span style=color:#569cd6;>if </span><span>self.next_free_frame < start_frame {
</span><span>            self.next_free_frame = start_frame;
</span><span>        }
</span><span>    }
</span><span>}
</span></code></pre><p>This function chooses the area with the minimal base address that still has free frames, i.e. <code>next_free_frame</code> is smaller than its last frame. Note that we need to clone the iterator because the <a href=https://doc.rust-lang.org/nightly/core/iter/trait.Iterator.html#method.min_by_key>min_by_key</a> function consumes it. If there are no areas with free frames left, <code>min_by_key</code> automatically returns the desired <code>None</code>.<p>If the <code>next_free_frame</code> is below the new <code>current_area</code>, it needs to be updated to the area‚Äôs start frame. Else, the <code>allocate_frame</code> call could return an unavailable frame.<p>We don‚Äôt have a data structure to store free frames, so we can‚Äôt implement <code>deallocate_frame</code> reasonably. Thus we use the <code>unimplemented</code> macro, which just panics when the method is called:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>impl </span><span>FrameAllocator </span><span style=color:#569cd6;>for </span><span>AreaFrameAllocator {
</span><span>    </span><span style=color:#569cd6;>fn </span><span>allocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self) -> Option&LTFrame> {
</span><span>        </span><span style=color:#608b4e;>// described above
</span><span>    }
</span><span>
</span><span>    </span><span style=color:#569cd6;>fn </span><span>deallocate_frame(</span><span style=color:#569cd6;>&mut </span><span>self, _frame: Frame) {
</span><span>        unimplemented!()
</span><span>    }
</span><span>}
</span></code></pre><p>Now we only need a constructor function to make the allocator usable:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>pub fn </span><span>new(kernel_start: </span><span style=color:#569cd6;>usize</span><span>, kernel_end: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>      multiboot_start: </span><span style=color:#569cd6;>usize</span><span>, multiboot_end: </span><span style=color:#569cd6;>usize</span><span>,
</span><span>      memory_areas: MemoryAreaIter) -> AreaFrameAllocator
</span><span>{
</span><span>    </span><span style=color:#569cd6;>let mut</span><span> allocator = AreaFrameAllocator {
</span><span>        next_free_frame: Frame::containing_address(</span><span style=color:#b5cea8;>0</span><span>),
</span><span>        current_area: None,
</span><span>        areas: memory_areas,
</span><span>        kernel_start: Frame::containing_address(kernel_start),
</span><span>        kernel_end: Frame::containing_address(kernel_end),
</span><span>        multiboot_start: Frame::containing_address(multiboot_start),
</span><span>        multiboot_end: Frame::containing_address(multiboot_end),
</span><span>    };
</span><span>    allocator.choose_next_area();
</span><span>    allocator
</span><span>}
</span></code></pre><p>Note that we call <code>choose_next_area</code> manually here because <code>allocate_frame</code> returns <code>None</code> as soon as <code>current_area</code> is <code>None</code>. So by calling <code>choose_next_area</code> we initialize it to the area with the minimal base address.<h3 id=testing-it><a aria-label="Anchor link for: testing-it" class=zola-anchor href=#testing-it>üîó</a>Testing it</h3><p>In order to test it in main, we need to <a href=https://doc.rust-lang.org/1.30.0/book/first-edition/crates-and-modules.html#re-exporting-with-pub-use>re-export</a> the <code>AreaFrameAllocator</code> in the <code>memory</code> module. Then we can create a new allocator:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>let mut</span><span> frame_allocator = memory::AreaFrameAllocator::new(
</span><span>    kernel_start </span><span style=color:#569cd6;>as usize</span><span>, kernel_end </span><span style=color:#569cd6;>as usize</span><span>, multiboot_start,
</span><span>    multiboot_end, memory_map_tag.memory_areas());
</span></code></pre><p>Now we can test it by adding some frame allocations:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span>println!(</span><span style=color:#d69d85;>"</span><span style=color:#b4cea8;>{:?}</span><span style=color:#d69d85;>"</span><span>, frame_allocator.allocate_frame());
</span></code></pre><p>You will see that the frame number starts at <code>0</code> and increases steadily, but the kernel and Multiboot frames are left out (you need to allocate many frames to see this since the kernel starts at frame 256).<p>The following <code>for</code> loop allocates all frames and prints out the total number of allocated frames:<pre class=language-rust data-lang=rust style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-rust data-lang=rust><span style=color:#569cd6;>for</span><span> i </span><span style=color:#569cd6;>in </span><span style=color:#b5cea8;>0</span><span style=color:#569cd6;>.. </span><span>{
</span><span>    </span><span style=color:#569cd6;>if let </span><span>None = frame_allocator.allocate_frame() {
</span><span>        println!(</span><span style=color:#d69d85;>"allocated </span><span style=color:#b4cea8;>{}</span><span style=color:#d69d85;> frames"</span><span>, i);
</span><span>        </span><span style=color:#569cd6;>break</span><span>;
</span><span>    }
</span><span>}
</span></code></pre><p>You can try different amounts of memory by passing e.g. <code>-m 500M</code> to QEMU. To compare these numbers, <a href="https://www.wolframalpha.com/input/?i=%2832605+*+4096%29+bytes+in+MiB">WolframAlpha</a> can be very helpful.<h2 id=conclusion><a aria-label="Anchor link for: conclusion" class=zola-anchor href=#conclusion>üîó</a>Conclusion</h2><p>Now we have a working frame allocator. It is a bit rudimentary and cannot free frames, but it also is very fast since it reuses the Multiboot memory map and does not need any costly initialization. A future post will build upon this allocator and add a stack-like data structure for freed frames.<h2 id=what-s-next><a aria-label="Anchor link for: what-s-next" class=zola-anchor href=#what-s-next>üîó</a>What‚Äôs next?</h2><p>The <a href=https://os.phil-opp.com/page-tables/>next post</a> will be about paging again. We will use the frame allocator to create a safe module that allows us to switch page tables and map pages. Then we will use this module and the information from the Elf-sections tag to remap the kernel correctly.<h2 id=recommended-posts><a aria-label="Anchor link for: recommended-posts" class=zola-anchor href=#recommended-posts>üîó</a>Recommended Posts</h2><p>Eric Kidd started the <a href=http://www.randomhacks.net/bare-metal-rust/>Bare Metal Rust</a> series last week. Like this post, it builds upon the code from <a href=https://os.phil-opp.com/printing-to-screen/>Printing to Screen</a>, but tries to support keyboard input instead of wrestling through memory management details.</main><div><hr><div class=PageNavigation><a class=prev href=/printing-to-screen/>¬´ Printing to Screen</a><a class=next href=/page-tables/>Page Tables ¬ª</a></div><hr><section><h2>Comments (Archived)</h2><section id=isso-thread><div id=isso-root><div class=isso-comment id=isso-32><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-32 rel=nofollow><time title="Mon Nov 16 2015 01:26:09 GMT+0100 (Central European Standard Time)" datetime=2015-10-01T00:26:09Z>vor 4 Jahren</time></a><span class=note></span></div><div class=text><p>There is some interesting discussion on <a href=https://www.reddit.com/r/rust/comments/3sw52x/writing_an_os_in_rust_allocating_frames/ rel=nofollow>reddit</a>.</div><div class=isso-comment-footer><span class=votes>-1</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-33><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=0bc2df00636d shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=4 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=36 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=28></rect><rect style="fill: #f19670" height=8 width=8 x=12 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=28 y=36></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=12></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=20></rect><rect style="fill: #f19670" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Tobias Schottdorf</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-33 rel=nofollow><time title="Mon Nov 16 2015 02:31:18 GMT+0100 (Central European Standard Time)" datetime=2015-10-01T01:31:18Z>vor 4 Jahren</time></a><span class=note></span></div><div class=text><p>> Note that we need to clone the iterator because the order of areas in the memory map isn't specified.<p>Could you elaborate on that? I'm probably getting something wrong, but I can't reproduce issues omitting the clone:<p>https://gist.github.com/tschottdorf/e1e0a4091136dd281ab3</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-34><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-34 rel=nofollow><time title="Mon Nov 16 2015 14:18:18 GMT+0100 (Central European Standard Time)" datetime=2015-10-01T13:18:18Z>vor 4 Jahren</time></a><span class=note></span></div><div class=text><p>The `clone` is required because the <a href=https://doc.rust-lang.org/nightly/core/iter/trait.Iterator.html#method.min_by rel=nofollow>min_by</a> function consumes the iterator. I updated that sentence. My initial reasoning was that we can't just use the next area in the iterator because Multiboot doesn't specify an increasing ordering. Thus we need to use `min_by` and clone the iterator.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-35><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=3c7600465bac shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Vikas Reddy</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-35 rel=nofollow><time title="Tue Apr 05 2016 17:20:19 GMT+0200 (Central European Summer Time)" datetime=2016-03-02T15:20:19Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>Later you are identity mapping the VGA buffer address..but in the frame allocator allocate_frame() function you are not pointing that out...may be some time later when you allocate more frames...it may be allocated to some other page...</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-36><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-36 rel=nofollow><time title="Tue Apr 05 2016 17:48:07 GMT+0200 (Central European Summer Time)" datetime=2016-03-02T15:48:07Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>Good catch! Fortunately it is part of the <a href=http://os.phil-opp.com/allocating-frames.html#available-memory rel=nofollow>memory hole</a> below the 1MiB mark. Thus it is never allocated by the frame allocator.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-37><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=2246f825942c shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Errma Gerrd</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-37 rel=nofollow><time title="Wed Jun 15 2016 15:42:52 GMT+0200 (Central European Summer Time)" datetime=2016-05-03T13:42:52Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>if let Some(area) = self.current_area {<p>produces a `if let` arms have incompatible types [E0308] for me. (expected type `_` found type `()`.<p>is this due to my rust version (rustc 1.11.0-nightly (0554abac6 2016-06-10)? :o<p>EDIT:<p>i found my error!<br>// `frame` was not valid, try it again with the updated `next_free_frame`<br>self.allocate_frame();<p>should be -><p>// `frame` was not valid, try it again with the updated `next_free_frame`<br>return self.allocate_frame();<p>in my own code of course :)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-38><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=f3d5b0e5e954 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Gerald King</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-38 rel=nofollow><time title="Fri Jun 17 2016 10:11:56 GMT+0200 (Central European Summer Time)" datetime=2016-05-05T08:11:56Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>You can write simply `self.allocate_frame()` without `return`, but also without trailing semicolon (it's important). In Rust, it is considered better practice than using `return` as the last statement.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-39><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=2246f825942c shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Errma Gerrd</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-39 rel=nofollow><time title="Fri Jun 17 2016 10:14:44 GMT+0200 (Central European Summer Time)" datetime=2016-05-05T08:14:44Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>yes... that semicolon killed me :D<p>I think I'll stick with `return expression;` because it looks alot more explicit :o<br>but thanks for the clue anyway! :)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-40><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=f3d5b0e5e954 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Gerald King</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-40 rel=nofollow><time title="Fri Jun 17 2016 10:31:59 GMT+0200 (Central European Summer Time)" datetime=2016-05-05T08:31:59Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>Not at all :) I'm a Rust newbie too, and that syntax seems a bit unfamiliar for C++, Java, Python etc. programmers. (But Ruby has such a feature.)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-41><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=2246f825942c shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Errma Gerrd</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-41 rel=nofollow><time title="Fri Jun 17 2016 10:38:05 GMT+0200 (Central European Summer Time)" datetime=2016-05-05T08:38:05Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>I use CoffeeScript at work which has this feature too. But I merely use it<br>using return IMHO has the advantage that it gets syntax highlighted in another color and you can scan easier for function return points :)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div><div class="isso-comment isso-no-votes" id=isso-42><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=f3d5b0e5e954 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=12></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Gerald King</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-42 rel=nofollow><time title="Fri Jun 17 2016 10:41:34 GMT+0200 (Central European Summer Time)" datetime=2016-05-05T08:41:34Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>You are probably right about this :)</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-43><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=991d55c50857 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Gabriel Eiseman</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-43 rel=nofollow><time title="Sat Jul 23 2016 07:02:09 GMT+0200 (Central European Summer Time)" datetime=2016-06-06T05:02:09Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>These articles of yours are very good: I'm following them in C because they are better than any C tutorial I have yet found. However, I ran into a small problem with this one. In your Multiboot crate you define the ELF symbols tag as having 3 32 bit integers where the multiboot specification pdf you link to specifies 4 16 bit integers. The layout in your crate seems to be correct though, because I defined a struct in C (using __attribute__((packed))) according to the pdf and it did not work, but when I mirrored your layout it did.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-44><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-44 rel=nofollow><time title="Sat Jul 23 2016 13:13:30 GMT+0200 (Central European Summer Time)" datetime=2016-06-06T11:13:30Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>Thanks for the nice words :). Honestly, I'm not quite sure about this. It's been a while since I wrote this code‚Ä¶<p>The multiboot specification (<a href=http://nongnu.askapache.com/grub/phcoder/multiboot.pdf rel=nofollow>PDF</a>) says:<p><blockquote>This tag contains section header table from an ELF kernel, the size of each entry, number of entries, and the string table used as the index of names. They correspond to the ‚Äòshdr_*‚Äô entries (‚Äòshdr_num‚Äô, etc.) in the Executable and Linkable Format (elf) specification in the program header.</blockquote><p><p>So the `shdr_` entries are just the entries of the ELF header. The problem is that the multiboot specification uses 32-bit elf files implicitly, but our kernel is a 64-bit elf. There seem to be some format differences‚Ä¶ However, the ELF64 specification (<a href=https://www.uclibc.org/docs/elf-64-gen.pdf rel=nofollow>PDF</a>) uses u16s too‚Ä¶<p><a href=https://github.com/phil-opp/multiboot2-elf64#the-elf-symbols-tag rel=nofollow>In the Readme</a> of the multiboot2 crate I wrote:<p><blockquote>Note that this format differs from the description in the Multiboot specification because if seems to be wrong for ELF 64 kernels: The number of entries, entry size, and string table fields seem to be u32 instead of u16 (but I'm not sure on this).</blockquote><p><p>So I wasn't even sure on this when I wrote it :D.<p>I did some digging in the GRUB2 source and found the definition of <a href=https://github.com/josefbacik/grub2/blob/96695ad84ce9c93f057ba53ae77d04d8561586e9/include/multiboot2.h#L298-L300 rel=nofollow>`multiboot_tag_elf_sections`</a>. Like the multiboot2 crate, it uses 3 u32s. So it seems like the crate is correct.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-46><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=5abac2da368c shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=4 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=36 y=36></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=20></rect><rect style="fill: #be5168" height=8 width=8 x=12 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=28 y=28></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=4></rect><rect style="fill: #be5168" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Redrield</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-46 rel=nofollow><time title="Thu Nov 03 2016 23:02:09 GMT+0100 (Central European Standard Time)" datetime=2016-10-04T22:02:09Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>When I get to the part when we're getting the kernel start and end, I'm getting a triple fault and the OS is stuck in a bootloop. This is my Bochs log <a href=https://gist.github.com/Redrield/0634cb13260d743afc828c62fa5c102c rel=nofollow>https://gist.github.com/Red...</a></div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-47><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=666df3217240 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=12></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=12></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-47 rel=nofollow><time title="Mon Nov 07 2016 09:38:20 GMT+0100 (Central European Standard Time)" datetime=2016-10-01T08:38:20Z>vor 3 Jahren</time></a><span class=note></span></div><div class=text><p>Hmm, I don't use Bochs, but according to <a href=http://bochs.sourceforge.net/doc/docbook/user/bios-tips.html rel=nofollow>this page</a> of the Bochs user manual it seems to be a ‚Äúno atapi cdrom found‚Äú error. I have no idea why it occurs though‚Ä¶ Does it work in QEMU?</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-325><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=8c9119b1b577 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Johan Montelius</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-325 rel=nofollow><time title="Wed Oct 11 2017 11:47:32 GMT+0200 (Central European Summer Time)" datetime=2017-09-03T09:47:32Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Could we not use the start_address() and end_address() that are available in the BootInformation instead of doing the address calculation ourselves?<p>let multiboot_start = boot_info.start_address();<p>let multiboot_end = boot_info.end_address();</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-326><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=b865bd725108 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=4 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=36 y=28></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=4></rect><rect style="fill: #9abf88" height=8 width=8 x=12 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=28 y=36></rect><rect style="fill: #9abf88" height=8 width=8 x=20 y=36></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Philipp Oppermann</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-326 rel=nofollow><time title="Wed Oct 11 2017 12:52:54 GMT+0200 (Central European Summer Time)" datetime=2017-09-03T10:52:54Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Sure! I think they were introduced after this post was written and I forgot to update this post.</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div><div class="isso-comment isso-no-votes" id=isso-346><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c409a273b137 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Madeleine Berner</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-346 rel=nofollow><time title="Sun Dec 03 2017 16:48:23 GMT+0100 (Central European Standard Time)" datetime=2017-11-00T15:48:23Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Hi! Your link for "re-export" under the section "Testing it" is broken.<p>Are you supposed to do something with the instruction "In order to test it in main, we need to re-export the AreaFrameAllocator in the memorymodule." ? I keep getting this error: "Could not find <code>AreaFrameAllocator</code> in <code>memory</code> "<p>in src/lib.rs on this row:<p>let mut frame_allocator = memory::AreaFrameAllocator::new(...</div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up><div class="isso-comment isso-no-votes" id=isso-347><div class=avatar><svg preserveaspectratio="xMinYMin meet" viewbox="0 0 48 48" data-hash=c409a273b137 shape-rendering=crispEdges version=1.1><rect style="fill: #f0f0f0" height=56 width=56 x=0 y=0></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=12></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=4 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=36 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=4></rect><rect style="fill: #447c69" height=8 width=8 x=12 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=28 y=36></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=20></rect><rect style="fill: #447c69" height=8 width=8 x=20 y=28></rect></svg></div><div class=text-wrapper><div class=isso-comment-header role=meta><span class=author>Madeleine Berner</span><span class=spacer>‚Ä¢</span><a class=permalink href=#isso-347 rel=nofollow><time title="Sun Dec 03 2017 17:20:19 GMT+0100 (Central European Standard Time)" datetime=2017-11-00T16:20:19Z>letztes Jahr</time></a><span class=note></span></div><div class=text><p>Hi (again)! I just found the code to add to fix my problem. Perhaps you can add it to your blog post?<p>From this commit I added the new lines from the file mod.rs:<p><a href=https://github.com/phil-opp/blog_os/commit/9f1a69cafa8a1b09dd71cbf3bf7493e388576391#diff-8c6f6418d9ea96c33ce93b05462bfd65 rel=nofollow>https://github.com/phil-opp/blog_os/commit/9f1a69cafa8a1b09dd71cbf3bf7493e388576391#diff-8c6f6418d9ea96c33ce93b05462bfd65</a></div><div class=isso-comment-footer><span class=votes>0</span><a class=upvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,18.299c-0.651-0.669-7.512-7.203-7.512-7.203C 16.912,10.739, 16.456,10.56, 16,10.56c-0.458,0-0.914,0.179-1.261,0.536 c0,0-6.861,6.534-7.514,7.203c-0.651,0.669-0.696,1.872,0,2.586c 0.698,0.712, 1.669,0.77, 2.522,0L 16,14.89l 6.251,5.995 c 0.854,0.77, 1.827,0.712, 2.522,0C 25.47,20.17, 25.427,18.966, 24.773,18.299z"> </path> </g> </svg> </a><span class=spacer>|</span><a class=downvote href=# rel=nofollow><svg viewbox="0 0 32 32" fill=gray height=16 width=16 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink> <g> <path d="M 24.773,13.701c-0.651,0.669-7.512,7.205-7.512,7.205C 16.912,21.262, 16.456,21.44, 16,21.44c-0.458,0-0.914-0.178-1.261-0.534 c0,0-6.861-6.536-7.514-7.205c-0.651-0.669-0.696-1.87,0-2.586c 0.698-0.714, 1.669-0.77, 2.522,0L 16,17.112l 6.251-5.995 c 0.854-0.77, 1.827-0.714, 2.522,0C 25.47,11.83, 25.427,13.034, 24.773,13.701z"> </path> </g> </svg> </a><a class=reply href=# rel=nofollow>Antworten</a></div><div class=isso-follow-up></div></div></div></div></div></div></div></section></section></div><footer class=footer><hr><small> ¬© <time datetime=2017>2017</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer></div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>