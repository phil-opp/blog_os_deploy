<!doctype html><html lang=en><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="light dark" name=color-scheme><meta content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code." name=description><meta content="Philipp Oppermann" name=author><link href=https://os.phil-opp.com/cross-compile-binutils/ rel=canonical><link href=/css/edition-2/main.css rel=stylesheet><link title="RSS feed for os.phil-opp.com" href=https://os.phil-opp.com/rss.xml rel=alternate type=application/rss+xml><script>let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }</script><script async src=/js/edition-2/main.js></script><title>Cross Compile Binutils | Writing an OS in Rust</title><body><div class="container content"><header class=masthead><div style=position:relative><h2 class=masthead-title><a href=https://os.phil-opp.com title=Home>Writing an OS in Rust</a></h2><p><small>PhilippÂ Oppermann'sÂ blog</small></div></header><div class=theme-switch><div title="Switch between light and dark theme" class=light-switch onclick=toggle_lights()></div><div title="Clear the theme override and go back to the system theme" class=light-switch-reset onclick=clear_theme_override()></div></div><div><main><h1>Cross Compile Binutils</h1><p>The <a href=https://www.gnu.org/software/binutils/>GNU Binutils</a> are a collection of various binary tools such as <code>ld</code>, <code>as</code>, <code>objdump</code>, or <code>readelf</code>. These tools are platform-specific, so you need to compile them again if your host system and target system are different. In our case, we need <code>ld</code> and <code>objdump</code> for the x86_64 architecture.<h2 id=building-setup><a aria-label="Anchor link for: building-setup" class=zola-anchor href=#building-setup>ðŸ”—</a>Building Setup</h2><p>First, you need to download a current binutils version from <a href=ftp://sourceware.org/pub/binutils/snapshots>here</a> (the latest one is near the bottom). After extracting, you should have a folder named <code>binutils-2.X</code> where <code>X</code> is for example <code>25.1</code>. Now can create and switch to a new folder for building (recommended):<pre class=language-bash data-lang=bash style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-bash data-lang=bash><span>mkdir build-binutils
</span><span>cd build-binutils
</span></code></pre><h2 id=configuration><a aria-label="Anchor link for: configuration" class=zola-anchor href=#configuration>ðŸ”—</a>Configuration</h2><p>We execute binutilsâ€™s <code>configure</code> and pass a lot of arguments to it (replace the <code>X</code> with the version number):<pre class=language-bash data-lang=bash style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-bash data-lang=bash><span>../binutils-2.X/configure --target=x86_64-elf --prefix=</span><span style=color:#d69d85;>"$</span><span>HOME</span><span style=color:#d69d85;>/opt/cross" </span><span>\
</span><span>    --disable-nls --disable-werror \
</span><span>    --disable-gdb --disable-libdecnumber --disable-readline --disable-sim
</span></code></pre><ul><li>The <code>target</code> argument specifies the the x86_64 target architecture.<li>The <code>prefix</code> argument selects the installation directory, you can change it if you like. But be careful that you do not overwrite your systemâ€™s binutils.<li>The <code>disable-nls</code> flag disables native language support (so youâ€™ll get the same english error messages). It also reduces build dependencies.<li>The <code>disable-werror</code> turns all warnings into errors.<li>The last line disables features we donâ€™t need to reduce compile time.</ul><h2 id=building-it><a aria-label="Anchor link for: building-it" class=zola-anchor href=#building-it>ðŸ”—</a>Building it</h2><p>Now we can build and install it to the location supplied as <code>prefix</code> (it will take a while):<pre class=language-bash data-lang=bash style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-bash data-lang=bash><span>make
</span><span>make install
</span></code></pre><p>Now you should have multiple <code>x86_64-elf-XXX</code> files in <code>$HOME/opt/cross/bin</code>.<h2 id=adding-it-to-the-path><a aria-label="Anchor link for: adding-it-to-the-path" class=zola-anchor href=#adding-it-to-the-path>ðŸ”—</a>Adding it to the PATH</h2><p>To use the tools from the command line easily, you should add the <code>bin</code> folder to your PATH:<pre class=language-bash data-lang=bash style=background-color:#1e1e1e;color:#dcdcdc;><code class=language-bash data-lang=bash><span style=color:#569cd6;>export </span><span>PATH=</span><span style=background-color:#282828;color:#d69d85;>"$</span><span style=background-color:#282828;color:#dcdcdc;>HOME</span><span style=background-color:#282828;color:#d69d85;>/opt/cross/bin:$</span><span style=background-color:#282828;color:#dcdcdc;>PATH</span><span style=background-color:#282828;color:#d69d85;>"</span><span>
</span></code></pre><p>If you add this line to your e.g. <code>.bashrc</code>, the <code>x86_64-elf-XXX</code> commands are always available.</main></div><div></div><footer class=footer><hr><small> Â© <time datetime=2021>2021</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer></div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>