<!doctype html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code.">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="https://os.phil-opp.com/cross-compile-binutils/" />
    
    <link href="/css/poole.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">

    <script async src="/js/main.js"></script>

    <title>Cross Compile Binutils | Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h2 class="masthead-title">
                    <a href="https://os.phil-opp.com" title="Home">Writing an OS in Rust</a>
                </h2>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
            </div>
        </header>

        <main>
    <h1>Cross Compile Binutils</h1>
    <p>The <a href="https://www.gnu.org/software/binutils/">GNU Binutils</a> are a collection of various binary tools such as <code>ld</code>, <code>as</code>, <code>objdump</code>, or <code>readelf</code>. These tools are platform-specific, so you need to compile them again if your host system and target system are different. In our case, we need <code>ld</code> and <code>objdump</code> for the x86_64 architecture.</p>
<h2 id="building-setup"><a class="zola-anchor" href="#building-setup" aria-label="Anchor link for: building-setup">ðŸ”—</a>Building Setup</h2>
<p>First, you need to download a current binutils version from <a href="ftp://sourceware.org/pub/binutils/snapshots">here</a> (the latest one is near the bottom). After extracting, you should have a folder named <code>binutils-2.X</code> where <code>X</code> is for example <code>25.1</code>. Now can create and switch to a new folder for building (recommended):</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">mkdir build-binutils
cd build-binutils
</span></pre><h2 id="configuration"><a class="zola-anchor" href="#configuration" aria-label="Anchor link for: configuration">ðŸ”—</a>Configuration</h2>
<p>We execute binutils's <code>configure</code> and pass a lot of arguments to it (replace the <code>X</code> with the version number):</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">../binutils-2.X/configure --target=x86_64-elf --prefix=</span><span style="color:#d69d85;">&quot;$</span><span style="color:#dcdcdc;">HOME</span><span style="color:#d69d85;">/opt/cross&quot; </span><span style="color:#dcdcdc;">\
    --disable-nls --disable-werror \
    --disable-gdb --disable-libdecnumber --disable-readline --disable-sim
</span></pre>
<ul>
<li>The <code>target</code> argument specifies the the x86_64 target architecture.</li>
<li>The <code>prefix</code> argument selects the installation directory, you can change it if you like. But be careful that you do not overwrite your system's binutils.</li>
<li>The <code>disable-nls</code> flag disables native language support (so you'll get the same english error messages). It also reduces build dependencies.</li>
<li>The <code>disable-werror</code> turns all warnings into errors.</li>
<li>The last line disables features we don't need to reduce compile time.</li>
</ul>
<h2 id="building-it"><a class="zola-anchor" href="#building-it" aria-label="Anchor link for: building-it">ðŸ”—</a>Building it</h2>
<p>Now we can build and install it to the location supplied as <code>prefix</code> (it will take a while):</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">make
make install
</span></pre>
<p>Now you should have multiple <code>x86_64-elf-XXX</code> files in <code>$HOME/opt/cross/bin</code>.</p>
<h2 id="adding-it-to-the-path"><a class="zola-anchor" href="#adding-it-to-the-path" aria-label="Anchor link for: adding-it-to-the-path">ðŸ”—</a>Adding it to the PATH</h2>
<p>To use the tools from the command line easily, you should add the <code>bin</code> folder to your PATH:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#569cd6;">export </span><span style="color:#dcdcdc;">PATH=</span><span style="background-color:#282828;color:#d69d85;">&quot;$</span><span style="background-color:#282828;color:#dcdcdc;">HOME</span><span style="background-color:#282828;color:#d69d85;">/opt/cross/bin:$</span><span style="background-color:#282828;color:#dcdcdc;">PATH</span><span style="background-color:#282828;color:#d69d85;">&quot;</span><span style="color:#dcdcdc;">
</span></pre>
<p>If you add this line to your e.g. <code>.bashrc</code>, the <code>x86_64-elf-XXX</code> commands are always available.</p>

</main>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2020">2020</time>. All rights reserved.
                <a href="https://os.phil-opp.com/contact/">Contact</a>
            </small>
        </footer>
    </div>

    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
        (function(f, a, t, h, o, m){
            a[h]=a[h]||function(){
                (a[h].q=a[h].q||[]).push(arguments)
            };
            o=f.createElement('script'),
            m=f.getElementsByTagName('script')[0];
            o.async=1; o.src=t; o.id='fathom-script';
            m.parentNode.insertBefore(o,m)
        })(document, window, '//fathom.phil-opp.com/tracker.js', 'fathom');
        fathom('set', 'siteId', 'MUXWM');
        fathom('trackPageview');
    </script>
    <!-- / Fathom -->
</body>

</html>
