<!doctype html><html lang=en><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="light dark" name=color-scheme><meta content="I finally managed to get blog_os building on my Android phone using termux. This post explains the necessary steps to set it up.
" name=description><meta content="Philipp Oppermann" name=author><link href=https://os.phil-opp.com/edition-2/extra/building-on-android/ rel=canonical><link href=/css/edition-2/main.css rel=stylesheet><link title="RSS feed for os.phil-opp.com" href=https://os.phil-opp.com/rss.xml rel=alternate type=application/rss+xml><script>let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }</script><script async src=/js/edition-2/main.js></script><title>Building on Android | Writing an OS in Rust</title><body><div class="container content"><header class=masthead><div style=position:relative><h2 class=masthead-title><a href=https://os.phil-opp.com title=Home>Writing an OS in Rust</a></h2><p><small>PhilippÂ Oppermann'sÂ blog</small></div></header><div class=theme-switch><div title="Switch between light and dark theme" class=light-switch onclick=toggle_lights()></div><div title="Clear the theme override and go back to the system theme" class=light-switch-reset onclick=clear_theme_override()></div></div><div><main><h1>Building on Android</h1><p>I finally managed to get <code>blog_os</code> building on my Android phone using <a href=https://termux.com/>termux</a>. This post explains the necessary steps to set it up.</p><span id=continue-reading></span><img alt="Screenshot of the compilation output from android" style="height: 50rem;" src=building-on-android.png><h3 id=install-termux-and-nightly-rust><a aria-label="Anchor link for: install-termux-and-nightly-rust" class=zola-anchor href=#install-termux-and-nightly-rust>ðŸ”—</a>Install Termux and Nightly Rust</h3><p>First, install <a href=https://termux.com/>termux</a> from the <a href="https://play.google.com/store/apps/details?id=com.termux">Google Play Store</a> or from F-Droid. After installing, open it and perform the following steps:<ul><li><p>Install fish shell, set as default shell, and launch it:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>pkg install fish
</span><span>chsh -s fish
</span><span>fish
</span></code></pre> <p>This step is of course optional. However, if you continue with bash you will need to adjust some of the following commands to bash syntax.</p><li><p>Install some basic tools:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>pkg install wget tar
</span></code></pre><li><p>Add the <a href=https://wiki.termux.com/wiki/Package_Management#By_its-pointless>community repository by its-pointless</a>:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>wget https://its-pointless.github.io/setup-pointless-repo.sh
</span><span>bash setup-pointless-repo.sh
</span></code></pre><li><p>Install cargo and a nightly version of rustc:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>pkg install rustc cargo rustc-nightly
</span></code></pre><li><p>Prepend the nightly rustc path to your <code>PATH</code> in order to use nightly (fish syntax):</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>set -U fish_user_paths $PREFIX/opt/rust-nightly/bin/ $fish_user_paths
</span></code></pre></ul><p>Now <code>rustc --version</code> should work and output a nightly version number.<h3 id=install-git-and-clone-blog-os><a aria-label="Anchor link for: install-git-and-clone-blog-os" class=zola-anchor href=#install-git-and-clone-blog-os>ðŸ”—</a>Install Git and Clone blog_os</h3><p>We need something to compile, so letâ€™s download the <code>blog_os</code> repository:<ul><li><p>Install git:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>pkg install git
</span></code></pre><li><p>Clone the <code>blog_os</code> repository:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>git clone https://github.com/phil-opp/blog_os.git
</span></code></pre></ul><p>If you want to clone/push via SSH, you need to install the <code>openssh</code> package: <code>pkg install openssh</code>.<h3 id=install-xbuild-and-bootimage><a aria-label="Anchor link for: install-xbuild-and-bootimage" class=zola-anchor href=#install-xbuild-and-bootimage>ðŸ”—</a>Install Xbuild and Bootimage</h3><p>Now weâ€™re ready to install <code>cargo xbuild</code> and <code>bootimage</code><ul><li><p>Run <code>cargo install</code>:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>cargo install cargo-xbuild bootimage
</span></code></pre><li><p>Add the cargo bin directory to your <code>PATH</code> (fish syntax):</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>set -U fish_user_paths ~/.cargo/bin/ $fish_user_paths
</span></code></pre></ul><p>Now <code>cargo xbuild</code> and <code>bootimage</code> should be available. It does not work yet because <code>cargo xbuild</code> needs access to the rust source code. By default it tries to use rustup for this, but we have no rustup support so we need a different way.<h3 id=providing-the-rust-source-code><a aria-label="Anchor link for: providing-the-rust-source-code" class=zola-anchor href=#providing-the-rust-source-code>ðŸ”—</a>Providing the Rust Source Code</h3><p>The Rust source code corresponding to our installed nightly is available in the <a href=https://github.com/its-pointless/its-pointless.github.io><code>its-pointless</code> repository</a>:<ul><li><p>Download a tar containing the source code:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>wget https://github.com/its-pointless/its-pointless.github.io/raw/master/rust-src-nightly.tar.xz
</span></code></pre><li><p>Extract it:</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>tar xf rust-src-nightly.tar.xz
</span></code></pre><li><p>Set the <code>XARGO_RUST_SRC</code> environment variable to tell cargo-xbuild the source path (fish syntax):</p> <pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>set -Ux XARGO_RUST_SRC ~/rust-src-nightly/rust-src/lib/rustlib/src/rust/src
</span></code></pre></ul><p>Now cargo-xbuild should no longer complain about a missing <code>rust-src</code> component. However it will throw an I/O error after building the sysroot. The problem is that the downloaded Rust source code has a different structure than the source provided by rustup. We can fix this by adding a symbolic link:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>ln -s ~/../usr/opt/rust-nightly/bin ~/../usr/opt/rust-nightly/lib/rustlib/aarch64-linux-android/bin
</span></code></pre><p>Now <code>cargo xbuild --target x86_64-blog_os.json</code> and <code>bootimage build</code> should both work!<p>I couldnâ€™t get QEMU to run yet, so you wonâ€™t be able to run your kernel. If you manage to get it working, please tell me :).</main></div><div><hr><section><h2 id=comments>Comments</h2><p class=comment-note>Do you have a problem, want to share feedback, or discuss further ideas? Feel free to leave a comment here! Please stick to English and follow Rust's <a href=https://www.rust-lang.org/policies/code-of-conduct>code of conduct</a>. This comment thread directly maps to a <a href='https://github.com/phil-opp/blog_os/discussions/categories/post-comments?discussions_q="Building on Android (Extra Post)"'><em>discussion on GitHub</em></a>, so you can also comment there if you prefer.<div class=giscus></div><script data-category="Post Comments" data-repo-id="MDEwOlJlcG9zaXRvcnkzOTU3NTEwMQ==" data-term="Building on Android (Extra Post)" async crossorigin=anonymous data-category-id=MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDE4OTg1 data-emit-metadata=1 data-mapping=specific data-reactions-enabled=1 data-repo=phil-opp/blog_os data-theme=preferred_color_scheme src=https://giscus.app/client.js></script><p class=comment-directly-on-github>Instead of authenticating the <a href=https://giscus.app>giscus</a> application, you can also comment directly <a href='https://github.com/phil-opp/blog_os/discussions/categories/post-comments?discussions_q="Building on Android (Extra Post)"'><em>on GitHub</em></a>.</section></div><footer class=footer><hr><small> Â© <time datetime=2021>2021</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer></div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>