<!doctype html><html lang=en><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="light dark" name=color-scheme><meta content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code." name=description><meta content="Philipp Oppermann" name=author><link href=https://os.phil-opp.com/cross-compile-libcore/ rel=canonical><link href=/css/edition-2/main.css rel=stylesheet><link title="RSS feed for os.phil-opp.com" href=https://os.phil-opp.com/rss.xml rel=alternate type=application/rss+xml><script>let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }</script><script async src=/js/edition-2/main.js></script><title>Cross Compiling: libcore | Writing an OS in Rust</title><body><div class="container content"><header class=masthead><div style=position:relative><h2 class=masthead-title><a href=https://os.phil-opp.com title=Home>Writing an OS in Rust</a></h2><p><small>PhilippÂ Oppermann'sÂ blog</small></div></header><div class=theme-switch><div title="Switch between light and dark theme" class=light-switch onclick=toggle_lights()></div><div title="Clear the theme override and go back to the system theme" class=light-switch-reset onclick=clear_theme_override()></div></div><div><main><h1>Cross Compiling: libcore</h1><p>If you get an <code>error: can't find crate for 'core'</code>, youâ€™re probably compiling for a different target (e.g. youâ€™re passing the <code>target</code> option to <code>cargo build</code>). Now the compiler complains that it canâ€™t find the <code>core</code> library. This document gives a quick overview how to fix this problem. For more details, see the <a href=https://github.com/japaric/rust-cross>rust-cross</a> project.<h2 id=libcore><a aria-label="Anchor link for: libcore" class=zola-anchor href=#libcore>ğŸ”—</a>Libcore</h2><p>The core library is a dependency-free library that is added implicitly when using <code>#![no_std]</code>. It provides basic standard library features like Option or Iterator. The core library is installed together with the rust compiler (just like the std library). But the installed libcore is specific to your architecture. If you arenâ€™t working on x86_64 Linux and pass <code>â€‘â€‘target x86_64â€‘unknownâ€‘linuxâ€‘gnu</code> to cargo, it canâ€™t find a x86_64 libcore. To fix this, you can either use <code>rustup</code> or <code>xargo</code>.<h2 id=rustup><a aria-label="Anchor link for: rustup" class=zola-anchor href=#rustup>ğŸ”—</a>rustup</h2><p>Thanks to <a href=https://rustup.rs>rustup</a>, cross-compilation for <a href=https://github.com/japaric/rust-cross#the-target-triple>official target triples</a> is pretty easy today: Just execute <code>rustup target add x86_64-unknown-linux-gnu</code>.<h2 id=xargo><a aria-label="Anchor link for: xargo" class=zola-anchor href=#xargo>ğŸ”—</a>xargo</h2><p>If youâ€™re using a <em>custom target specification</em>, the <code>rustup</code> method doesnâ€™t work. Instead, you can use <a href=https://github.com/japaric/xargo>xargo</a>. Xargo is a wrapper for cargo that eases cross compilation. We can install it by executing:<pre style=background-color:#1e1e1e;color:#dcdcdc;><code><span>cargo install xargo
</span></code></pre><p>If the installation fails, make sure that you have <code>cmake</code> and the OpenSSL headers installed. For more details, see the xargoâ€™s <a href=https://github.com/japaric/xargo#dependencies>dependency section</a>.<p>Xargo is â€œa drop-in replacement for cargoâ€, so every cargo command also works with <code>xargo</code>. You can do e.g. <code>xargo --help</code>, <code>xargo clean</code>, or <code>xargo doc</code>. However, the <code>build</code> command gains additional functionality: <code>xargo build</code> will automatically cross compile the <code>core</code> library (and a few other libraries such as <code>alloc</code>) when compiling for custom targets.<p>So if your custom target file is named <code>your-cool-target.json</code>, you can compile your code using xargo through <code>xargo build --target your-cool-target</code> (note the omitted extension).</main></div><div></div><footer class=footer><hr><small> Â© <time datetime=2021>2021</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer></div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>