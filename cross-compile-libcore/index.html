<!doctype html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code.">
    <meta name="author" content="Philipp Oppermann">

    
        <link rel="canonical" href="https://os.phil-opp.com/cross-compile-libcore/" />
    
    <link href="/css/poole.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">

    <script async src="/js/main.js"></script>

    <title>Cross Compiling: libcore | Writing an OS in Rust</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <div style="position:relative">
                <h2 class="masthead-title">
                    <a href="https://os.phil-opp.com" title="Home">Writing an OS in Rust</a>
                </h2>
                <p><small>Philipp&nbsp;Oppermann's&nbsp;blog</small></p>
                
            </div>
        </header>

        <main>
    <h1>Cross Compiling: libcore</h1>
    <p>If you get an <code>error: can't find crate for 'core'</code>, you're probably compiling for a different target (e.g. you're passing the <code>target</code> option to <code>cargo build</code>). Now the compiler complains that it can't find the <code>core</code> library. This document gives a quick overview how to fix this problem. For more details, see the <a href="https://github.com/japaric/rust-cross">rust-cross</a> project.</p>
<h2 id="libcore"><a class="zola-anchor" href="#libcore" aria-label="Anchor link for: libcore">üîó</a>Libcore</h2>
<p>The core library is a dependency-free library that is added implicitly when using <code>#![no_std]</code>. It provides basic standard library features like Option or Iterator. The core library is installed together with the rust compiler (just like the std library). But the installed libcore is specific to your architecture. If you aren't working on x86_64 Linux and pass <code>‚Äë‚Äëtarget x86_64‚Äëunknown‚Äëlinux‚Äëgnu</code> to cargo, it can't find a x86_64 libcore. To fix this, you can either use <code>rustup</code> or <code>xargo</code>.</p>
<h2 id="rustup"><a class="zola-anchor" href="#rustup" aria-label="Anchor link for: rustup">üîó</a>rustup</h2>
<p>Thanks to <a href="https://rustup.rs">rustup</a>, cross-compilation for <a href="https://github.com/japaric/rust-cross#the-target-triple">official target triples</a> is pretty easy today: Just execute <code>rustup target add x86_64-unknown-linux-gnu</code>.</p>
<h2 id="xargo"><a class="zola-anchor" href="#xargo" aria-label="Anchor link for: xargo">üîó</a>xargo</h2>
<p>If you're using a <em>custom target specification</em>, the <code>rustup</code> method doesn't work. Instead, you can use <a href="https://github.com/japaric/xargo">xargo</a>. Xargo is a wrapper for cargo that eases cross compilation. We can install it by executing:</p>
<pre style="background-color:#1e1e1e;">
<span style="color:#dcdcdc;">cargo install xargo
</span></pre>
<p>If the installation fails, make sure that you have <code>cmake</code> and the OpenSSL headers installed. For more details, see the xargo's <a href="https://github.com/japaric/xargo#dependencies">dependency section</a>.</p>
<p>Xargo is ‚Äúa drop-in replacement for cargo‚Äù, so every cargo command also works with <code>xargo</code>. You can do e.g. <code>xargo --help</code>, <code>xargo clean</code>, or <code>xargo doc</code>. However, the <code>build</code> command gains additional functionality: <code>xargo build</code> will automatically cross compile the <code>core</code> library (and a few other libraries such as <code>alloc</code>) when compiling for custom targets.</p>
<p>So if your custom target file is named <code>your-cool-target.json</code>, you can compile your code using xargo through <code>xargo build --target your-cool-target</code> (note the omitted extension).</p>

</main>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2020">2020</time>. All rights reserved.
                <a href="https://os.phil-opp.com/contact/">Contact</a>
            </small>
        </footer>
    </div>

    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
        (function(f, a, t, h, o, m){
            a[h]=a[h]||function(){
                (a[h].q=a[h].q||[]).push(arguments)
            };
            o=f.createElement('script'),
            m=f.getElementsByTagName('script')[0];
            o.async=1; o.src=t; o.id='fathom-script';
            m.parentNode.insertBefore(o,m)
        })(document, window, '//fathom.phil-opp.com/tracker.js', 'fathom');
        fathom('set', 'siteId', 'MUXWM');
        fathom('trackPageview');
    </script>
    <!-- / Fathom -->
</body>

</html>
