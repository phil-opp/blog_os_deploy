<!doctype html><html lang=fa><head><meta charset=UTF-8><meta content=yes name=apple-mobile-web-app-capable><meta content="width=device-width,initial-scale=1" name=viewport><meta content="light dark" name=color-scheme><meta content="This blog series creates a small operating system in the Rust programming language. Each post is a small tutorial and includes all needed code." name=description><meta content="Philipp Oppermann" name=author><link href=https://os.phil-opp.com/fa/ rel=canonical><link href=/css/edition-2/main.css rel=stylesheet><link title="RSS feed for os.phil-opp.com" href=https://os.phil-opp.com/rss.xml rel=alternate type=application/rss+xml><script>let theme = localStorage.getItem("theme");
        if (theme != null) {
            document.documentElement.setAttribute("data-theme", theme);
        }</script><script async src=/js/edition-2/main.js></script><title>Writing an OS in Rust</title><body><div class="container content"><header class=masthead><div style=position:relative><h2 class=masthead-title><a href=https://os.phil-opp.com title=Home>Writing an OS in Rust</a></h2><p><small>Philipp Oppermann's blog</small></div></header><div class=theme-switch><div title="Switch between light and dark theme" class=light-switch onclick=toggle_lights()></div><div title="Clear the theme override and go back to the system theme" class=light-switch-reset onclick=clear_theme_override()></div></div><div><main><h1 style="visibility: hidden; height: 0px; margin: 0px; padding: 0px;">نوشتن یک سیستم عامل با راست</h1><div class="front-page-introduction right-to-left"><p>این مجموعه بلاگ یک سیستم عامل کوچک در <a href=https://www.rust-lang.org/>زبان برنامه نویسی Rust</a> ایجاد می کند. هر پست یک آموزش کوچک است و شامل تمام کدهای مورد نیاز است ، بنابراین اگر دوست دارید می توانید آن را دنبال کنید. کد منبع نیز در <a href=https://github.com/phil-opp/blog_os>مخزن گیت‌هاب</a> مربوطه موجود است.<p>اخرین پست: <strong><a href=/async-await/>Async/Await</a></strong></div><div></div><div class="post-category bare-bones" id=bare-bones>Bare Bones</div><div class="posts bare-bones"><div class=right-to-left><h2 class=post-title><a href=/fa/freestanding-rust-binary/> یک باینری مستقل Rust</a></h2><div class=post-summary><p>اولین قدم برای نوشتن سیستم‌عامل، ساخت یک باینری راست (کلمه: Rust) هست که به کتابخانه استاندارد نیازمند نباشد. این باعث می‌شود تا بتوانیم کد راست را بدون سیستم‌عامل زیرین، بر روی سخت افزار <a href=https://en.wikipedia.org/wiki/Bare_machine>bare metal</a> اجرا کنیم.</p><a class=read-more href=/fa/freestanding-rust-binary/><em>ادامه‌مطلب»</em></a></div></div><div class=right-to-left><h2 class=post-title><a href=/fa/minimal-rust-kernel/>یک هسته مینیمال با Rust</a></h2><div class=post-summary><p>در این پست ما برای معماری x86 یک هسته مینیمال ۶۴ بیتی به زبان راست می‌سازیم. با استفاده از باینری مستقل Rust از پست قبل، یک دیسک ایمیج قابل بوت می‌سازیم، که متنی را در صفحه چاپ کند.</p><a class=read-more href=/fa/minimal-rust-kernel/><em>ادامه‌مطلب»</em></a></div></div><div class=right-to-left><h2 class=post-title><a href=/fa/vga-text-mode/>حالت متن VGA</a></h2><div class=post-summary><p><a href=https://en.wikipedia.org/wiki/VGA-compatible_text_mode>حالت متن VGA</a> یک روش ساده برای چاپ متن روی صفحه است. در این پست ، با قرار دادن همه موارد غیر ایمنی در یک ماژول جداگانه ، رابطی ایجاد می کنیم که استفاده از آن را ایمن و ساده می کند. همچنین پشتیبانی از <a href=https://doc.rust-lang.org/std/fmt/#related-macros>ماکروی فرمت‌بندی</a> راست را پیاده سازی میکنیم.</p><a class=read-more href=/fa/vga-text-mode/><em>ادامه‌مطلب»</em></a></div></div><div class=right-to-left><h2 class=post-title><a href=/fa/testing/>تست کردن</a></h2><div class=post-summary><p>این پست به بررسی تست‌های واحد (ترجمه: unit) و یکپارچه (ترجمه: integration) در فایل‌های اجرایی ‌<code>no_std</code> می‌پردازد. ما از پشتیبانی Rust برای فریم‌ورک تست‌های سفارشی استفاده می‌کنیم تا توابع تست را درون کرنل‌مان اجرا کنیم. برای گزارش کردن نتایج خارج از QEMU، از ویژگی‌های مختلف QEMU و ابزار <code>bootimage</code> استفاده می‌کنیم.</p><a class=read-more href=/fa/testing/><em>ادامه‌مطلب»</em></a></div></div></div><div class="post-category interrupts" id=interrupts>Interrupts</div><div class="posts interrupts"><div class=right-to-left><h2 class=post-title><a href=/fa/cpu-exceptions/>استثناهای پردازنده</a></h2><div class=post-summary><p>استثناهای پردازنده در موقعیت های مختلف دارای خطا رخ می دهد ، به عنوان مثال هنگام دسترسی به آدرس حافظه نامعتبر یا تقسیم بر صفر. برای واکنش به آنها ، باید یک <em>جدول توصیف کننده وقفه</em> تنظیم کنیم که توابع کنترل کننده را فراهم کند. در انتهای این پست ، هسته ما قادر به گرفتن <a href=https://wiki.osdev.org/Exceptions#Breakpoint>استثناهای breakpoint</a> و ادامه اجرای طبیعی پس از آن خواهد بود.</p><a class=read-more href=/fa/cpu-exceptions/><em>ادامه‌مطلب»</em></a></div></div><div class=right-to-left><h2 class=post-title><a href=/fa/double-fault-exceptions/>خطاهای دوگانه</a></h2><div class=post-summary><p>این پست به طور دقیق جزئیات استثنای خطای دوگانه (ترجمه: double fault exception) را بررسی می‌کند، این استثنا هنگامی رخ می‌دهد که CPU نتواند یک کنترل کننده استثنا را فراخوانی کند. با کنترل این استثنا، از بروز <em>خطاهای سه گانه</em> (ترجمه: triple faults) کشنده که باعث ریست (کلمه: reset) شدن سیستم می‌شوند، جلوگیری می‌کنیم. برای جلوگیری از خطاهای سه گانه در همه موارد، ما همچنین یک <em>Interrupt Stack Table</em> را تنظیم کرده‌ایم تا خطاهای دوگانه را روی یک پشته هسته جداگانه بگیرد.</p><a class=read-more href=/fa/double-fault-exceptions/><em>ادامه‌مطلب»</em></a></div></div><div class=right-to-left><h2 class=post-title><a href=/fa/hardware-interrupts/>وقفه‌های سخت‌افزاری</a></h2><div class=post-summary><p>در این پست ما کنترل کننده قابل برنامه ریزی وقفه را تنظیم می کنیم تا وقفه های سخت افزاری را به درستی به پردازنده منتقل کند. برای مدیریت این وقفه‌ها ، موارد جدیدی به جدول توصیف کننده وقفه اضافه می کنیم ، دقیقاً مانند کارهایی که برای کنترل کننده های استثنا انجام دادیم. ما یاد خواهیم گرفت که چگونه وقفه های متناوب تایمر را گرفته و چگونه از صفحه کلید ورودی بگیریم.</p><a class=read-more href=/fa/hardware-interrupts/><em>ادامه‌مطلب»</em></a></div></div></div><div class="post-category memory-management" id=memory-management>Memory Management</div><div class="posts memory-management"><div class=right-to-left><h2 class=post-title><a href=/fa/paging-introduction/>مقدمه‌ای بر صفحه‌بندی</a></h2><div class=post-summary><p>در این پست <em>صفحه‌بندی</em>، یک طرح مدیریت حافظه بسیار رایج که ما نیز برای سیستم‌عامل خود استفاده خواهیم کرد، معرفی می‌شود. این پست توضیح می‌دهد که چرا ایزوله سازی حافظه مورد نیاز است، قطعه‌بندی چگونه کار می‌کند، <em>حافظه مجازی</em> چیست و چگونه صفحه‌بندی مشکلات تقسیم حافظه را حل می کند. همچنین طرح جدول‌های صفحه چند سطحی را در معماری x86_64 بررسی می‌کند.</p><a class=read-more href=/fa/paging-introduction/><em>ادامه‌مطلب»</em></a></div></div><div><h2 class=post-title><a href=/paging-implementation/>Paging Implementation</a></h2><div class=post-summary><p>This post shows how to implement paging support in our kernel. It first explores different techniques to make the physical page table frames accessible to the kernel and discusses their respective advantages and drawbacks. It then implements an address translation function and a function to create a new mapping.</p><a class=read-more href=/paging-implementation/><em>ادامه‌مطلب»</em></a><aside class=no-translation>(.این پست هنوز ترجمه نشده است)</aside></div></div><div><h2 class=post-title><a href=/heap-allocation/>Heap Allocation</a></h2><div class=post-summary><p>This post adds support for heap allocation to our kernel. First, it gives an introduction to dynamic memory and shows how the borrow checker prevents common allocation errors. It then implements the basic allocation interface of Rust, creates a heap memory region, and sets up an allocator crate. At the end of this post all the allocation and collection types of the built-in <code>alloc</code> crate will be available to our kernel.</p><a class=read-more href=/heap-allocation/><em>ادامه‌مطلب»</em></a><aside class=no-translation>(.این پست هنوز ترجمه نشده است)</aside></div></div><div><h2 class=post-title><a href=/allocator-designs/>Allocator Designs</a></h2><div class=post-summary><p>This post explains how to implement heap allocators from scratch. It presents and discusses different allocator designs, including bump allocation, linked list allocation, and fixed-size block allocation. For each of the three designs, we will create a basic implementation that can be used for our kernel.</p><a class=read-more href=/allocator-designs/><em>ادامه‌مطلب»</em></a><aside class=no-translation>(.این پست هنوز ترجمه نشده است)</aside></div></div></div><div class="post-category multitasking" id=multitasking>Multitasking</div><div class="posts multitasking"><div><h2 class=post-title><a href=/async-await/>Async/Await</a></h2><div class=post-summary><p>In this post we explore <em>cooperative multitasking</em> and the <em>async/await</em> feature of Rust. We take a detailed look how async/await works in Rust, including the design of the <code>Future</code> trait, the state machine transformation, and <em>pinning</em>. We then add basic support for async/await to our kernel by creating an asynchronous keyboard task and a basic executor.</p><a class=read-more href=/async-await/><em>ادامه‌مطلب»</em></a><aside class=no-translation>(.این پست هنوز ترجمه نشده است)</aside></div></div></div><div class="posts subscribe"><h2 class=post-title>Subscribe</h2><p>Receive notifications about new posts and other major changes! You can either:<ul><li>Subscribe to our <a href=/rss.xml>RSS/Atom Feed</a>,<li>Subscribe to <a href=https://github.com/phil-opp/blog_os/issues/479>this GitHub issue</a>, or<li>Subscribe to our <a href=https://tinyletter.com/phil-opp/>email newsletter</a>.</ul></div><hr><div class=frontpage-section><h2>Status Updates</h2><p>These posts give a regular overview of the most important changes to the blog and the tools and libraries behind the scenes.<ul><b> <li><a href=https://rust-osdev.com/this-month/2021-12/>This Month in Rust OSDev (December 2021)</a></li> </b><b> <li><a href=https://rust-osdev.com/this-month/2021-11/>This Month in Rust OSDev (November 2021)</a></li> </b><b> <li><a href=https://rust-osdev.com/this-month/2021-10/>This Month in Rust OSDev (October 2021)</a></li> </b><b> <li><a href=https://rust-osdev.com/this-month/2021-09/>This Month in Rust OSDev (September 2021)</a></li> </b><b> <li><a href=https://rust-osdev.com/this-month/2021-08/>This Month in Rust OSDev (August 2021)</a></li> </b><li><a href=https://os.phil-opp.com/status-update/><em>view all »</em></a></ul></div><div class=frontpage-section><h2 class=post-title>First Edition</h2><p>You are currently viewing the second edition of “Writing an OS in Rust”. The first edition is very different in many aspects, for example it builds upon the GRUB bootloader instead of using the `bootloader` crate. In case you're interested in it, it is still available. Note that the first edition is no longer updated and might contain outdated information. <a class=read-more href=https://os.phil-opp.com/edition-1><em>read the first edition »</em></a></div><div><h2>Support Me</h2><p>Creating and <a href=https://os.phil-opp.com/status-update/>maintaining</a> this blog and the associated libraries is a lot of work, but I really enjoy doing it. By supporting me, you allow me to invest more time in new content, new features, and continuous maintenance.<p>The best way to support me is to <a href=https://github.com/sponsors/phil-opp><em>sponsor me on GitHub</em></a>, since they don't charge any fees. If you prefer other platforms, I also have <a href=https://www.patreon.com/phil_opp><em>Patreon</em></a> and <a href=https://donorbox.org/phil-opp><em>Donorbox</em></a> accounts. The latter is the most flexible as it supports multiple currencies and one-time contributions.<p>Thank you!</div></main></div><div><aside class=page-aside-right><div class=block id=language-selector><h2>Other Languages</h2><ul><li data-lang-switch-to=en><a href=https://os.phil-opp.com/> English (original) </a><li data-lang-switch-to=zh-CN><a href=https://os.phil-opp.com/zh-CN/> Chinese (simplified) </a><li data-lang-switch-to=zh-TW><a href=https://os.phil-opp.com/zh-TW/> Chinese (traditional) </a><li data-lang-switch-to=fr><a href=https://os.phil-opp.com/fr/> French </a><li data-lang-switch-to=ja><a href=https://os.phil-opp.com/ja/> Japanese </a><li data-lang-switch-to=ru><a href=https://os.phil-opp.com/ru/> Russian </a></ul></div><div class=block><h2>Recent Updates</h2> No notable updates recently.</div><div class=block><h2>Repository</h2><div class=gh-repo-box><div><svg viewbox="0 0 12 16" aria-hidden=true height=16 version=1.1 width=12><path d="M4 9H3V8h1v1zm0-3H3v1h1V6zm0-2H3v1h1V4zm0-2H3v1h1V2zm8-1v12c0 .55-.45 1-1 1H6v2l-1.5-1.5L3 16v-2H1c-.55 0-1-.45-1-1V1c0-.55.45-1 1-1h10c.55 0 1 .45 1 1zm-1 10H1v2h2v-1h3v1h5v-2zm0-10H2v9h9V1z" fill-rule=evenodd></path></svg><a class=repo-link href=https://github.com/phil-opp/blog_os> <span title=blog_os>phil-opp/blog_os</span> </a></div><p class=subtitle>Writing an OS in Rust<p class=stars-forks><a class=stars href=https://github.com/phil-opp/blog_os/stargazers> <svg viewbox="0 0 14 16" aria-label=stars height=16 role=img version=1.1 width=14><path d="M14 6l-4.9-.64L7 1 4.9 5.36 0 6l3.6 3.26L2.67 14 7 11.67 11.33 14l-.93-4.74L14 6z" fill-rule=evenodd></path></svg> 8.3k </a> <a class=forks href=https://github.com/phil-opp/blog_os/network/members> <svg viewbox="0 0 10 16" aria-label=forks height=16 role=img version=1.1 width=10><path d="M8 1a1.993 1.993 0 0 0-1 3.72V6L5 8 3 6V4.72A1.993 1.993 0 0 0 2 1a1.993 1.993 0 0 0-1 3.72V6.5l3 3v1.78A1.993 1.993 0 0 0 5 15a1.993 1.993 0 0 0 1-3.72V9.5l3-3V4.72A1.993 1.993 0 0 0 8 1zM2 4.2C1.34 4.2.8 3.65.8 3c0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3 10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2zm3-10c-.66 0-1.2-.55-1.2-1.2 0-.65.55-1.2 1.2-1.2.65 0 1.2.55 1.2 1.2 0 .65-.55 1.2-1.2 1.2z" fill-rule=evenodd></path></svg> 653 </a> <a class=sponsor href=https://github.com/sponsors/phil-opp> <svg viewbox="0 0 12 16" aria-hidden=true height=16 version=1.1 width=12><path d="M9 2c-.97 0-1.69.42-2.2 1-.51.58-.78.92-.8 1-.02-.08-.28-.42-.8-1-.52-.58-1.17-1-2.2-1-1.632.086-2.954 1.333-3 3 0 .52.09 1.52.67 2.67C1.25 8.82 3.01 10.61 6 13c2.98-2.39 4.77-4.17 5.34-5.33C11.91 6.51 12 5.5 12 5c-.047-1.69-1.342-2.913-3-3z" fill-rule=evenodd></path></svg> Sponsor </a></div></div><div class="dark-mode-note warning"><h2>Dark Mode is Experimental</h2><p>We're still working on adjusting text colors, fixing images, and removing inconsistencies. If you have any problems, please <a href=https://github.com/phil-opp/blog_os/issues>file an issue</a>.<aside></aside></div><footer class=footer><hr><small> © <time datetime=2021>2021</time>. All rights reserved. <a href=https://os.phil-opp.com/contact/>Contact</a> </small></footer><div><script async data-goatcounter=https://phil-opp.goatcounter.com/count src=//gc.zgo.at/count.js></script>