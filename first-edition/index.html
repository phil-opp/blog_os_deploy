<!doctype html>

<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="Philipp Oppermann">

    <link href="/css/poole.css" rel="stylesheet">
    <link href="/css/main.css" rel="stylesheet">
    <link href="/css/first-edition-isso.css" rel="stylesheet">

    <script async src="/js/main.js"></script>

    <title>Writing an OS in Rust (First Edition)</title>
</head>

<body>
    <div class="container content">
        <header class="masthead">
            <h1 class="masthead-title">
                <a href="/first-edition" title="Home">Writing an OS in Rust (First Edition)</a>
            </h1>
            <p><small>Philipp Oppermann&#x27;s blog</small></p>
        </header>

        <main>


<div class="front-page-introduction">
    <p>
        This blog series creates a small operating system in the
        <a href="https://www.rust-lang.org/">Rust programming language</a>. Each post is a small tutorial and includes all
        needed code, so you can follow along if you like. The source code is also available in the corresponding
        <a href="https://github.com/phil-opp/blog_os">Github repository</a>.
    </p>
    <p>Latest post:
        
        <strong><a href="/double-faults/">Double Faults</a></strong>
    </p>
</div>

<div class="warning">
    <b>No longer updated!</b> You are viewing the first edition of “Writing an OS in Rust”, which is no longer updated. You can find the second edition <a href="https:&#x2f;&#x2f;os.phil-opp.com&#x2f;second-edition&#x2f;">here</a>.
</div>

<div id="bare-bones" class="post-category bare-bones">Bare Bones</div>
<div class="posts bare-bones">
    
    <div>
        <h2 class="post-title"><a href="/multiboot-kernel/">A minimal Multiboot Kernel</a></h2>
        <div class="post-summary">
            <p>This post explains how to create a minimal x86 operating system kernel using the Multiboot standard. In fact, it will just boot and print <code>OK</code> to the screen. In subsequent blog posts we will extend it using the <a href="http://www.rust-lang.org/">Rust</a> programming language.</p>

            <a class="read-more" href="/multiboot-kernel/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/entering-longmode/">Entering Long Mode</a></h2>
        <div class="post-summary">
            <p>In the <a href="https://os.phil-opp.com/multiboot-kernel/">previous post</a> we created a minimal multiboot kernel. It just prints <code>OK</code> and hangs. The goal is to extend it and call 64-bit <a href="http://www.rust-lang.org/">Rust</a> code. But the CPU is currently in <a href="https://en.wikipedia.org/wiki/Protected_mode">protected mode</a> and allows only 32-bit instructions and up to 4GiB memory. So we need to set up <em>Paging</em> and switch to the 64-bit <a href="https://en.wikipedia.org/wiki/Long_mode">long mode</a> first.</p>

            <a class="read-more" href="/entering-longmode/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/set-up-rust/">Set Up Rust</a></h2>
        <div class="post-summary">
            <p>In the previous posts we created a <a href="https://os.phil-opp.com/multiboot-kernel/">minimal Multiboot kernel</a> and <a href="https://os.phil-opp.com/entering-longmode/">switched to Long Mode</a>. Now we can finally switch to <a href="https://www.rust-lang.org/">Rust</a> code. Rust is a high-level language without runtime. It allows us to not link the standard library and write bare metal code. Unfortunately the setup is not quite hassle-free yet.</p>

            <a class="read-more" href="/set-up-rust/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/printing-to-screen/">Printing to Screen</a></h2>
        <div class="post-summary">
            <p>In the <a href="https://os.phil-opp.com/set-up-rust/">previous post</a> we switched from assembly to <a href="https://www.rust-lang.org/">Rust</a>, a systems programming language that provides great safety. But so far we are using unsafe features like <a href="https://doc.rust-lang.org/book/raw-pointers.html">raw pointers</a> whenever we want to print to screen. In this post we will create a Rust module that provides a safe and easy-to-use interface for the VGA text buffer. It will support Rust's <a href="https://doc.rust-lang.org/std/fmt/#related-macros">formatting macros</a>, too.</p>

            <a class="read-more" href="/printing-to-screen/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<div id="memory-management" class="post-category memory-management">Memory Management</div>
<div class="posts memory-management">
    
    <div>
        <h2 class="post-title"><a href="/allocating-frames/">Allocating Frames</a></h2>
        <div class="post-summary">
            <p>In this post we create an allocator that provides free physical frames for a future paging module. To get the required information about available and used memory we use the Multiboot information structure. Additionally, we improve the <code>panic</code> handler to print the corresponding message and source line.</p>

            <a class="read-more" href="/allocating-frames/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/page-tables/">Page Tables</a></h2>
        <div class="post-summary">
            <p>In this post we will create a paging module, which allows us to access and modify the 4-level page table. We will explore recursive page table mapping and use some Rust features to make it safe. Finally we will create functions to translate virtual addresses and to map and unmap pages.</p>

            <a class="read-more" href="/page-tables/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/remap-the-kernel/">Remap the Kernel</a></h2>
        <div class="post-summary">
            <p>In this post we will create a new page table to map the kernel sections correctly. Therefore we will extend the paging module to support modifications of <em>inactive</em> page tables as well. Then we will switch to the new table and secure our kernel stack by creating a guard page.</p>

            <a class="read-more" href="/remap-the-kernel/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/kernel-heap/">Kernel Heap</a></h2>
        <div class="post-summary">
            <p>In the previous posts we created a <a href="https://os.phil-opp.com/allocating-frames/">frame allocator</a> and a <a href="https://os.phil-opp.com/page-tables/">page table module</a>. Now we are ready to create a kernel heap and a memory allocator. Thus, we will unlock <code>Box</code>, <code>Vec</code>, <code>BTreeMap</code>, and the rest of the <a href="https://doc.rust-lang.org/nightly/alloc/index.html">alloc</a> crate.</p>

            <a class="read-more" href="/kernel-heap/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<div id="interrupts" class="post-category exceptions">Exceptions</div>
<div class="posts exceptions">
    
    <div>
        <h2 class="post-title"><a href="/handling-exceptions/">Handling Exceptions</a></h2>
        <div class="post-summary">
            <p>In this post, we start exploring CPU exceptions. Exceptions occur in various erroneous situations, for example when accessing an invalid memory address or when dividing by zero. To catch them, we have to set up an <em>interrupt descriptor table</em> that provides handler functions. At the end of this post, our kernel will be able to catch <a href="http://wiki.osdev.org/Exceptions#Breakpoint">breakpoint exceptions</a> and to resume normal execution afterwards.</p>

            <a class="read-more" href="/handling-exceptions/">read&nbsp;more…</a>
        </div>
    </div>

    
    <div>
        <h2 class="post-title"><a href="/double-faults/">Double Faults</a></h2>
        <div class="post-summary">
            <p>In this post we explore double faults in detail. We also set up an <em>Interrupt Stack Table</em> to catch double faults on a separate kernel stack. This way, we can completely prevent triple faults, even on kernel stack overflow.</p>

            <a class="read-more" href="/double-faults/">read&nbsp;more…</a>
        </div>
    </div>

</div>

<hr>

<h1>Extra Content</h1>
<ul>
    
        
        <li><a href="/first-edition/extra/naked-exceptions/">Handling Exceptions using naked Functions</a></li>
    
    
        <li><a href="/talks/">Talks</a></li>
    
        <li><a href="/cross-compile-binutils/">Cross Compile Binutils</a></li>
    
        <li><a href="/cross-compile-libcore/">Cross Compiling: libcore</a></li>
    
        <li><a href="/set-up-gdb/">Set Up GDB</a></li>
    
</ul>

<aside id="recent-updates">
    <h2>Recent Updates</h2>
    <ul>
  <li><a href="https://github.com/phil-opp/blog_os/pull/650">Rewrite section about no-harness tests</a> <time datetime="2019-08-07T10:39:29">Aug&nbsp;07</time></li>
  <li><a href="https://github.com/phil-opp/blog_os/pull/648">Updates in July 2019</a> <time datetime="2019-08-02T09:16:00">Aug&nbsp;02</time></li>
  <li><a href="https://github.com/phil-opp/blog_os/pull/644">Update paging introduction post to use page fault error code</a> <time datetime="2019-07-22T08:47:34">Jul&nbsp;22</time></li>
</ul>
</aside>

</main>

        <div></div>

        <footer class="footer">
            <hr>
            <small>
                &copy; <time datetime="2017">2017</time>. All rights reserved.
                <a href="https:&#x2f;&#x2f;os.phil-opp.com&#x2f;contact&#x2f;">Contact</a>
            </small>
        </footer>
    </div>

    <!-- Fathom - simple website analytics - https://github.com/usefathom/fathom -->
    <script>
        (function(f, a, t, h, o, m){
            a[h]=a[h]||function(){
                (a[h].q=a[h].q||[]).push(arguments)
            };
            o=f.createElement('script'),
            m=f.getElementsByTagName('script')[0];
            o.async=1; o.src=t; o.id='fathom-script';
            m.parentNode.insertBefore(o,m)
        })(document, window, '//fathom.phil-opp.com/tracker.js', 'fathom');
        fathom('set', 'siteId', 'MUXWM');
        fathom('trackPageview');
    </script>
    <!-- / Fathom -->
</body>

</html>
